System.register(["jimu-core","jimu-arcgis"],(function(e,t){var n={},i={};return{setters:[function(e){n.DataSourceComponent=e.DataSourceComponent,n.FormattedMessage=e.FormattedMessage,n.React=e.React,n.jsx=e.jsx,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){i.JimuMapViewComponent=e.JimuMapViewComponent}],execute:function(){e((()=>{var e={56:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{"use strict";var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var r={},l=[],a=0;a<e.length;a++){var s=e[a],u=i.base?s[0]+i.base:s[0],c=r[u]||0,d="".concat(u," ").concat(c);r[u]=c+1;var p=n(d),f={css:s[1],media:s[2],sourceMap:s[3],supports:s[4],layer:s[5]};if(-1!==p)t[p].references++,t[p].updater(f);else{var v=o(f,i);i.byIndex=a,t.splice(a,0,{identifier:d,updater:v,references:1})}l.push(d)}return l}function o(e,t){var n=t.domAPI(t);n.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var r=i(e=e||[],o=o||{});return function(e){e=e||[];for(var l=0;l<r.length;l++){var a=n(r[l]);t[a].references--}for(var s=i(e,o),u=0;u<r.length;u++){var c=n(r[u]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}r=s}}},113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},244:e=>{"use strict";e.exports=n},314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,o,r){"string"==typeof e&&(e=[[null,e,void 0]]);var l={};if(i)for(var a=0;a<this.length;a++){var s=this[a][0];null!=s&&(l[s]=!0)}for(var u=0;u<e.length;u++){var c=[].concat(e[u]);i&&l[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=r),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),t.push(c))}},t}},400:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(601),o=n.n(i),r=n(314),l=n.n(r)()(o());l.push([e.id,'.parking-lot-widget{padding:16px;font-family:"Avenir Next","Helvetica Neue",Arial,sans-serif}.parking-lot-widget,.parking-lot-widget *{pointer-events:none !important;user-select:none !important}.widget-header{margin-bottom:16px}.widget-header h3{margin:0;font-size:18px;font-weight:600;color:#323232}.widget-content{min-height:100px}.parking-lot-list{display:flex;flex-direction:column;gap:12px}.parking-lot-item{background:white;border-radius:8px;padding:10px 12px;box-shadow:0 2px 8px rgba(0, 0, 0, 0.1);border:1px solid #e0e0e0}.parking-lot-content{display:flex;align-items:center;gap:12px;margin-bottom:2px}.utilization-dot{width:20px;height:20px;border-radius:50%;flex-shrink:0;border:2px solid white;box-shadow:0 1px 3px rgba(0, 0, 0, 0.2)}.parking-lot-name{font-size:16px;font-weight:700;color:#323232;line-height:1.3;display:flex;align-items:center}.utilization-text{font-size:14px;color:#666;font-weight:400;margin-left:32px}.no-data{text-align:center;color:#999;font-style:italic;padding:20px;background:#f8f8f8;border-radius:8px;border:1px dashed #ccc}.loading{text-align:center;color:#666;padding:20px;background:#f8f8f8;border-radius:8px;border:1px solid #e0e0e0}@media(max-width: 480px){.parking-lot-widget{padding:12px}.parking-lot-item{padding:10px}.parking-lot-name{font-size:14px}.utilization-text{font-size:12px}}.parking-lot-item:hover{box-shadow:0 4px 12px rgba(0, 0, 0, 0.15);transform:translateY(-1px);transition:all .2s ease}.parking-lot-widget.loading{opacity:.6;pointer-events:none}.parking-lot-widget.loading::after{content:"";position:absolute;top:50%;left:50%;width:20px;height:20px;margin:-10px 0 0 -10px;border:2px solid #f3f3f3;border-top:2px solid #3498db;border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}',""]);const a=l},540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{"use strict";e.exports=function(e){return e[1]}},659:e=>{"use strict";var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},686:e=>{"use strict";e.exports=i},825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,o&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function o(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={id:n,exports:{}};return e[n](r,r.exports,o),r.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="",o.nc=void 0;var r={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(r),o.d(r,{__set_webpack_public_path__:()=>N,default:()=>E});var e=o(244),t=o(686),n=o(72),i=o.n(n),l=o(825),a=o.n(l),s=o(659),u=o.n(s),c=o(56),d=o.n(c),p=o(540),f=o.n(p),v=o(113),m=o.n(v),h=o(400),y={};y.styleTagTransform=m(),y.setAttributes=d(),y.insert=u().bind(null,"head"),y.domAPI=a(),y.insertStyleElement=f();i()(h.A,y);h.A&&h.A.locals&&h.A.locals;const g="Please configure a data source in the widget settings";var x=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function l(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}s((i=i.apply(e,t||[])).next())}))};const b="http://www.w3.org/2000/svg",w=50,A=46,S=(e,t,n,i)=>{const o=Math.PI/180*i;return{x:e+n*Math.cos(o),y:t+n*Math.sin(o)}},C=(e,t,n,i,o)=>{const r=i+o,l=S(e,t,n,i),a=S(e,t,n,r),s=Math.abs(o)>180?"1":"0",u=o<0?"0":"1";return["M",l.x.toFixed(2),l.y.toFixed(2),"A",n.toFixed(2),n.toFixed(2),"0",s,u,a.x.toFixed(2),a.y.toFixed(2)].join(" ")},k=(e,t,n,i,o)=>{const r=S(e,t,n,i),l=S(e,t,n,i+o),a=Math.abs(o)>180?"1":"0",s=o<0?"0":"1";return["M",e.toFixed(2),t.toFixed(2),"L",r.x.toFixed(2),r.y.toFixed(2),"A",n.toFixed(2),n.toFixed(2),"0",a,s,l.x.toFixed(2),l.y.toFixed(2),"Z"].join(" ")},E=n=>{const{config:i,id:o,useDataSources:r,useMapWidgetIds:l}=n,a=(null==r?void 0:r[0])||null,s=!!(l&&l.length>0),u=!!a,c=s&&u,[d,p]=e.React.useState(null),[f,v]=e.React.useState([]),[m,h]=e.React.useState(null),[y,S]=e.React.useState(null),[E,N]=e.React.useState(!1),[R,M]=e.React.useState(!0),F=e.React.useRef(null),z=e.React.useRef(null),T=e.React.useRef([]),I=e.React.useRef(null),j=e.React.useRef(null),P=e.React.useRef(!1),L=e.React.useRef(!1),U=e.React.useRef(null),q=e.React.useRef(0),D=e.React.useRef(null),O=e.React.useRef(null),B=e.React.useRef(null),$=(null==a?void 0:a.dataSourceId)||null,G=null!==$&&D.current===$,J=u&&R&&!G,_=e.React.useMemo((()=>({returnGeometry:!0,outFields:["*"]})),[]),K=e.React.useRef(!1),W=1e3,H=e.React.useCallback((e=>{var t;const n=null==l?void 0:l[0],i=null===(t=null==e?void 0:e.view)||void 0===t?void 0:t.container,o=null==i?void 0:i.parentElement,r=n?document.querySelector(`[data-widget-id="${n}"] .map-root`):null,a=n?document.querySelector(`[data-widget-id="${n}"] .esri-view-root`):null,s=n?document.querySelector(`[data-widget-id="${n}"] .esri-view`):null,u=n?document.querySelector(`[data-widget-id="${n}"]`):null;return i||o||a||s||r||u||null}),[l]),V=e.React.useCallback((e=>{if(!e)return;e.querySelectorAll(".parking-lot-map-label").forEach((e=>{e.parentNode&&e.parentNode.removeChild(e)}))}),[]),Z=e.React.useCallback((e=>{var t,n,i;if(!e)return null;if(null===(t=null==e?void 0:e.feature)||void 0===t?void 0:t.geometry)return e.feature;if((null===(n=null==e?void 0:e.feature)||void 0===n?void 0:n.attributes)&&"function"==typeof(null==e?void 0:e.getJSAPIGeometry)){const t=e.getJSAPIGeometry();if(t)return{geometry:t,attributes:e.feature.attributes}}if("function"==typeof(null==e?void 0:e.getJSAPIGeometry)){const t=e.getJSAPIGeometry(),n=(null===(i=e.getData)||void 0===i?void 0:i.call(e))||{};if(t)return{geometry:t,attributes:n}}return(null==e?void 0:e.attributes)&&(null==e?void 0:e.geometry)?e:null}),[]),Y=e.React.useCallback((e=>{var t;if(!e)return null;const n="function"==typeof(null==e?void 0:e.getData)&&e.getData()||null,i=(null===(t=null==e?void 0:e.feature)||void 0===t?void 0:t.attributes)||null,o=(null==e?void 0:e.attributes)||null,r={},l=e=>{e&&"object"==typeof e&&Object.keys(e).forEach((t=>{const n=e[t];null!=n?r[t]=n:t in r||(r[t]=n)}))};return l(i),l(o),l(n),Object.keys(r).length>0?r:null}),[]),Q=e.React.useCallback(((e,t)=>{if(!e||!t)return{value:void 0,resolvedKey:null};if(Object.prototype.hasOwnProperty.call(e,t))return{value:e[t],resolvedKey:t};const n=t.toLowerCase(),i=Object.keys(e),o=i.find((e=>e.toLowerCase().startsWith(n)));if(o)return{value:e[o],resolvedKey:o};const r=i.find((e=>n.startsWith(e.toLowerCase())));if(r)return{value:e[r],resolvedKey:r};const l=i.find((e=>e.toLowerCase().includes(n)));return l?{value:e[l],resolvedKey:l}:{value:void 0,resolvedKey:null}}),[]),X=e.React.useCallback((e=>{if("number"==typeof e)return Number.isFinite(e)?e:NaN;if("string"==typeof e){const t=e.trim().replace("%",""),n=Number(t);return Number.isFinite(n)?n:Number.isFinite(Number.parseFloat(t))?Number.parseFloat(t):NaN}const t=Number(e);return Number.isFinite(t)?t:NaN}),[]),ee=e.React.useCallback((e=>{const t=Q(e,i.utilizationField);if(Number.isFinite(X(t.value)))return t;if(!e)return t;const n=Object.keys(e).filter((e=>{const t=e.toLowerCase();return t.includes("util")||t.includes("occup")||t.includes("usage")}));for(const t of n){const n=e[t];if(Number.isFinite(X(n)))return{value:n,resolvedKey:t}}return t}),[Q,X,i.utilizationField]),te=e.React.useCallback((e=>{if(e){p(e);const t=H(e);t&&h(t)}}),[H]);e.React.useEffect((()=>{if(m||!(null==d?void 0:d.view))return;const e=H(d);e&&h(e)}),[d,m,H]),e.React.useEffect((()=>{if(!m)return;"static"===window.getComputedStyle(m).position&&(m.style.position="relative"),m.style.userSelect="none",m.style.webkitUserSelect="none",m.style.msUserSelect="none"}),[m]),e.React.useEffect((()=>{var e,t,n,i,o,r,l,a,s,u,c,d;if(!m)return;const p=m.closest(".map-base"),f=m.querySelector(".esri-view-surface"),v=m.querySelector("canvas"),h=null!==(e=null==p?void 0:p.style.pointerEvents)&&void 0!==e?e:"",y=null!==(t=null==p?void 0:p.style.position)&&void 0!==t?t:"",g=null!==(n=null==p?void 0:p.style.zIndex)&&void 0!==n?n:"",x=null!==(i=m.style.position)&&void 0!==i?i:"",b=null!==(o=m.style.zIndex)&&void 0!==o?o:"",w=null!==(r=m.style.pointerEvents)&&void 0!==r?r:"",A=null!==(l=null==f?void 0:f.style.pointerEvents)&&void 0!==l?l:"",S=null!==(a=null==f?void 0:f.style.position)&&void 0!==a?a:"",C=null!==(s=null==f?void 0:f.style.zIndex)&&void 0!==s?s:"",k=null!==(u=null==v?void 0:v.style.pointerEvents)&&void 0!==u?u:"",E=null!==(c=null==v?void 0:v.style.position)&&void 0!==c?c:"",N=null!==(d=null==v?void 0:v.style.zIndex)&&void 0!==d?d:"";return p&&(p.style.pointerEvents="auto","static"===window.getComputedStyle(p).position&&(p.style.position="relative"),p.style.zIndex="0"),"static"===window.getComputedStyle(m).position&&(m.style.position="relative"),m.style.pointerEvents="auto",m.style.zIndex="2",f&&(f.style.pointerEvents="auto",f.style.position="relative",f.style.zIndex="3"),v&&(v.style.pointerEvents="auto",v.style.position="relative",v.style.zIndex="4"),()=>{p&&(p.style.pointerEvents=h),p&&(p.style.position=y),p&&(p.style.zIndex=g),m.style.position=x,m.style.zIndex=b,m.style.pointerEvents=w,f&&(f.style.pointerEvents=A),f&&(f.style.position=S),f&&(f.style.zIndex=C),v&&(v.style.pointerEvents=k),v&&(v.style.position=E),v&&(v.style.zIndex=N)}}),[m]),e.React.useLayoutEffect((()=>{if(F.current)return()=>{}}),[o]),e.React.useLayoutEffect((()=>{var e;const t=null===(e=null==d?void 0:d.view)||void 0===e?void 0:e.container,n=[],i=(e,t)=>{e&&(n.push({el:e,prev:e.style.pointerEvents||""}),e.style.pointerEvents=t)},r=document.querySelector(`[data-widgetid="${o}"]`),l=document.querySelector(`[data-widget-id="${o}"]`),a=t?t.closest(".map-base"):null;r&&i(r,"none"),l&&l!==r&&i(l,"none"),F.current&&i(F.current,"none");const s=e=>{const t=e.classList;return(null==t?void 0:t.contains("builder-layout-item"))||(null==t?void 0:t.contains("is-widget"))||(null==t?void 0:t.contains("exb-rnd"))||(null==t?void 0:t.contains("functional-widg"))},u=e=>{var t,n;return(null===(t=null==e?void 0:e.classList)||void 0===t?void 0:t.contains("map-base"))||(null===(n=null==e?void 0:e.classList)||void 0===n?void 0:n.contains("esri-view-root"))||"BODY"===(null==e?void 0:e.tagName)};let c=(null==r?void 0:r.parentElement)||(null==l?void 0:l.parentElement);for(;c&&!u(c);)s(c)&&i(c,"none"),c=c.parentElement;if(t&&(i(a,"auto"),i(t,"auto")),t&&a){const e=t.getBoundingClientRect(),i=e.left+e.width/2,o=e.top+e.height/2;for(let e=0;e<5;e++){const e=document.elementsFromPoint(i,o)[0];if(!e||t===e||t.contains(e)||(null==a?void 0:a.contains(e)))break;if("none"===window.getComputedStyle(e).pointerEvents)break;(p=e)&&(n.push({el:p,prev:p.style.pointerEvents||"",usedImportant:!0}),p.style.setProperty("pointer-events","none","important"))}}var p;return()=>{n.forEach((({el:e,prev:t,usedImportant:n})=>{n?e.style.removeProperty("pointer-events"):e.style.pointerEvents=t}))}}),[o,d]),e.React.useEffect((()=>{if(d&&f.length>0){const e=()=>{const e=d.view.zoom,t=Math.max(.3,Math.min(1,(e-10)/8));f.forEach((e=>{try{const n=d.view.toScreen(e.geometry);if(e.element){e.element.style.transform=`scale(${t}) translateZ(0)`,e.element.style.transformOrigin="20px bottom";const i=e.element.offsetHeight||60;e.element.style.left=n.x-20+"px",e.element.style.top=n.y-i-8+"px"}}catch(e){}}))},t=()=>{null===I.current&&(I.current=window.requestAnimationFrame((()=>{I.current=null,e()})))},n=[d.view.watch("extent",t),d.view.watch("center",t),d.view.watch("zoom",t)],i=d.view;"function"==typeof(null==i?void 0:i.watch)&&(null!=i.width&&n.push(i.watch("width",t)),null!=i.height&&n.push(i.watch("height",t)));const o=null==i?void 0:i.container;let r=null;o&&"undefined"!=typeof ResizeObserver&&(r=new ResizeObserver(t),r.observe(o));const l=[],a="undefined"!=typeof window&&window.self!==window.top,s="undefined"!=typeof window&&(window.innerWidth<768||"ontouchstart"in window);return s&&l.push(window.setTimeout(t,250)),a&&(l.push(window.setTimeout(t,500)),l.push(window.setTimeout(t,1500))),a&&s&&l.push(window.setTimeout(t,3e3)),t(),()=>{l.forEach((e=>window.clearTimeout(e))),r&&o&&(r.unobserve(o),r.disconnect()),null!==I.current&&(window.cancelAnimationFrame(I.current),I.current=null),n.forEach((e=>{e&&"function"==typeof e.remove&&e.remove()}))}}}),[d,f]),e.React.useEffect((()=>()=>{f.forEach((e=>{e.element&&e.element.parentNode&&e.element.parentNode.removeChild(e.element)}))}),[f]),e.React.useEffect((()=>{K.current?(V(m),v([]),j.current=null,P.current=!1,L.current=!1,U.current=null,N(!0)):K.current=!0}),[V,i.parkingLotField,i.utilizationField,i.showUtilizationText,i.allowNegatives,i.fullThreshold,i.availableColor,i.unavailableColor]),e.React.useEffect((()=>{if(!r||0===r.length)return S(null),N(!1),M(!1),U.current=null,D.current=null,O.current=null,void(B.current=null);const e=$;null===y&&!!e&&D.current!==e&&B.current!==e&&(B.current=e,M(!0),N(!0),U.current=null,z.current=null,O.current=null),null!==y&&e!==y&&(z.current=null,V(m),v([]),j.current=null,P.current=!1,L.current=!1,U.current=null,D.current=null,B.current=null,N(!0),M(!0),O.current=null),y!==e&&S(e)}),[$,y,V,m]);const ne=e.React.useCallback((e=>{null==e||e.reason;return N(!0),!0}),[]),ie=e.React.useCallback((e=>{var t;if(!m)return;const n=m.querySelectorAll(".parking-lot-map-label");if(0===n.length)return;const o=new Map;n.forEach((e=>{const t=e.getAttribute("data-parking-lot-id");t&&o.set(t,e)}));for(const n of e){const e=Y(n);if(!e)continue;const{value:r}=Q(e,i.parkingLotField),{value:l}=ee(e),a=X(l);if(!r)continue;if(!Number.isFinite(a))continue;const s=String(r),u=o.get(s);if(!u)continue;const c=i.availableColor||"#d638c9",d=i.unavailableColor||"#8B8B8B",p=Math.max(0,Math.min(100,null!==(t=i.fullThreshold)&&void 0!==t?t:95));let f=100-a;!i.allowNegatives&&f<0&&(f=0);const v=a>=p||f<=Math.max(0,100-p)?"Full":`${Math.round(Math.max(0,Math.min(100,f)))}% Available`,m=i.showUtilizationText?v:"";let h=100-a;!i.allowNegatives&&h<0&&(h=0);const y=Math.max(0,Math.min(100,h));u.setAttribute("aria-label",`${r}: ${v}`);const g=Array.from(u.children),x=g[0],S=g[1];if(x){const e=x.querySelector("svg");if(e){const t=Math.max(0,Math.min(100,y)),n=-Math.min(t/100*360,359.999),i=Array.from(e.children),o=i[0];o&&"circle"===o.tagName&&o.setAttribute("fill",d);for(let t=i.length-2;t>=1;t--)e.removeChild(i[t]);if(t>0)if(t>=99.5){const t=document.createElementNS(b,"circle");t.setAttribute("cx",w.toFixed(2)),t.setAttribute("cy",w.toFixed(2)),t.setAttribute("r",(A-3).toFixed(2)),t.setAttribute("fill",c),t.setAttribute("stroke","none"),e.insertBefore(t,e.lastChild)}else{const t=document.createElementNS(b,"path");t.setAttribute("d",k(w,w,A-3,-90,n)),t.setAttribute("fill",c),t.setAttribute("stroke","none"),e.insertBefore(t,e.lastChild);const i=document.createElementNS(b,"path");i.setAttribute("d",C(w,w,A-3,-90,n)),i.setAttribute("fill","none"),i.setAttribute("stroke",c),i.setAttribute("stroke-width","3.5"),e.insertBefore(i,e.lastChild)}}}if(S){const e=Array.from(S.children);let t=i.showUtilizationText?0:-1,n=i.showUtilizationText?1:0;if(i.showUtilizationText&&t>=0&&e[t]){const n=e[t];n.textContent!==m&&(n.textContent=m)}if(e[n]){const t=e[n];t.textContent!==r&&(t.textContent=r)}}}}),[m,Y,Q,ee,X,i.parkingLotField,i.utilizationField,i.availableColor,i.unavailableColor,i.allowNegatives,i.showUtilizationText,i.fullThreshold]);e.React.useEffect((()=>{var e,t;if(!E)return;if(!(null===(e=null==d?void 0:d.view)||void 0===e?void 0:e.ready))return void N(!1);if(!y)return void N(!1);if(!m)return void N(!1);const n=z.current,i=$;if(!n||!i||y!==i)return void N(!1);if("LOADED"!==(null===(t=n.getStatus)||void 0===t?void 0:t.call(n)))return void N(!1);if(P.current||L.current)return;U.current=i;let o=!1;return P.current=!0,L.current=!0,x(void 0,void 0,void 0,(function*(){var e,t,r,l;try{const a=()=>x(void 0,void 0,void 0,(function*(){var e;return((null===(e=null==n?void 0:n.getRecords)||void 0===e?void 0:e.call(n))||[]).slice(0,W).map((e=>Z(e))).filter((e=>e)).filter((e=>null==e?void 0:e.geometry))})),s=yield a();if(o)return;if(0===s.length){const t=((null===(e=null==n?void 0:n.getRecords)||void 0===e?void 0:e.call(n))||[]).slice(0,W),o=t.length>0;return m.querySelectorAll(".parking-lot-map-label").length,o&&ie(t),N(!1),o?(M(!1),void(D.current=i)):void(U.current=null)}const u=((null===(t=null==n?void 0:n.getRecords)||void 0===t?void 0:t.call(n))||[]).slice(0,W),c=u.filter((e=>{const t=Y(e),{value:n}=ee(t);return Number.isFinite(X(n))})).length;if(u.length>0&&0===c)return v([]),m.querySelectorAll(".parking-lot-map-label").forEach((e=>e.remove())),N(!1),M(!1),void(D.current=i);const p=null===(r=null==d?void 0:d.view)||void 0===r?void 0:r.width,f=null===(l=null==d?void 0:d.view)||void 0===l?void 0:l.height,h="undefined"!=typeof window&&window.self!==window.top,y="undefined"!=typeof window&&(window.innerWidth<768||"ontouchstart"in window);if((!p||!f||p<10||f<10)&&(h||y)){U.current=null;const e=(q.current||0)+1;return q.current=e,e<=15&&window.setTimeout((()=>N(!0)),400),void N(!1)}const g=m.querySelectorAll(".parking-lot-map-label").length;0===g?(yield ae(s),m.querySelectorAll(".parking-lot-map-label").length>0&&(j.current=i)):yield se(s),N(!1),M(!1),D.current=i,q.current=0}catch(e){N(!1)}finally{P.current=!1,L.current=!1}})),()=>{o=!0}}),[E,d,y,$,m,i.parkingLotField,i.utilizationField,i.showUtilizationText,i.allowNegatives,i.fullThreshold,i.availableColor,i.unavailableColor,Z,Y,ee,X,ie]);const oe=e.React.useCallback(((e,t)=>{if(!e)return;const n=$;if(!n)return;if("LOAD_ERROR"===e.status)return N(!1),M(!1),void(D.current=n);"LOADED"===e.status&&U.current!==n&&D.current!==n&&ne({reason:"data-source-initial-loaded"})}),[$,ne]),re=e=>{var t;const n=Math.max(0,Math.min(100,null!==(t=i.fullThreshold)&&void 0!==t?t:95));let o=100-e;if(!i.allowNegatives&&o<0&&(o=0),e>=n||o<=Math.max(0,100-n))return"Full";const r=Math.max(0,Math.min(100,o));return`${Math.round(r)}% Available`},le=(e,t,n)=>{const i=Math.max(0,Math.min(100,e)),o=-Math.min(i/100*360,359.999),r=document.createElement("div");r.style.cssText="\n      width: 44px;\n      height: 44px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      flex-shrink: 0;\n      pointer-events: none;\n    ",r.setAttribute("aria-hidden","true");const l=document.createElementNS(b,"svg");l.setAttribute("width","44"),l.setAttribute("height","44"),l.setAttribute("viewBox","0 0 100 100"),l.style.display="block",l.style.flexShrink="0",l.style.pointerEvents="none",l.setAttribute("role","presentation"),l.setAttribute("focusable","false");const a=document.createElementNS(b,"circle");if(a.setAttribute("cx",w.toFixed(2)),a.setAttribute("cy",w.toFixed(2)),a.setAttribute("r",A.toFixed(2)),a.setAttribute("fill",n),a.setAttribute("stroke","none"),l.appendChild(a),i>0)if(i>=99.5){const e=document.createElementNS(b,"circle");e.setAttribute("cx",w.toFixed(2)),e.setAttribute("cy",w.toFixed(2)),e.setAttribute("r",(A-3).toFixed(2)),e.setAttribute("fill",t),e.setAttribute("stroke","none"),l.appendChild(e)}else{const e=document.createElementNS(b,"path");e.setAttribute("d",k(w,w,A-3,-90,o)),e.setAttribute("fill",t),e.setAttribute("stroke","none"),l.appendChild(e);const n=document.createElementNS(b,"path");n.setAttribute("d",C(w,w,A-3,-90,o)),n.setAttribute("fill","none"),n.setAttribute("stroke",t),n.setAttribute("stroke-width","3.5"),l.appendChild(n)}const s=document.createElementNS(b,"circle");return s.setAttribute("cx",w.toFixed(2)),s.setAttribute("cy",w.toFixed(2)),s.setAttribute("r",(A-1.5).toFixed(2)),s.setAttribute("fill","none"),s.setAttribute("stroke","#333333"),s.setAttribute("stroke-width","3"),l.appendChild(s),r.appendChild(l),r},ae=t=>x(void 0,void 0,void 0,(function*(){if(!m||!d)return;let n=null;try{n=(yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/projection","esri/geometry/Point","esri/geometry/SpatialReference"]))[0],yield n.load()}catch(e){}const o=new Set,r=[],l=new Map;m.querySelectorAll(".parking-lot-map-label").forEach((e=>{const t=e.getAttribute("data-parking-lot-id");t&&l.set(t,e)}));const a={};for(const e of t){const t=Y(e);let s=null;if(e.geometry)s=e.geometry;else try{if("function"==typeof e.getJSAPIGeometry)s=e.getJSAPIGeometry();else if("function"==typeof e.getGeometry){const t=e.getGeometry();t&&(s=t)}}catch(e){}const{value:u}=Q(t,i.parkingLotField),{value:c}=ee(t),p=X(c);if(!s){a.noGeometry=(a.noGeometry||0)+1;continue}if(!u){a.noName=(a.noName||0)+1;continue}if(!Number.isFinite(p)){a.invalidUtil=(a.invalidUtil||0)+1;continue}const f=i.availableColor||"#d638c9",v=i.unavailableColor||"#8B8B8B",h=re(p),y=i.showUtilizationText?h:"";let g=100-p;!i.allowNegatives&&g<0&&(g=0);const x=Math.max(0,Math.min(100,g)),S=String(u);o.add(S);try{const e=d.view.spatialReference,t=s.spatialReference;if(n&&t&&e&&t.wkid!==e.wkid){const t=n.project(s,e);t&&(s=t)}}catch(e){}let E;try{E=d.view.toScreen(s)}catch(e){a.coordError=(a.coordError||0)+1;continue}let N=l.get(S);const R=!N;if(N){const e=E.x-50+"px",n=E.y-30+"px";N.style.left!==e&&(N.style.left=e),N.style.top!==n&&(N.style.top=n),N.setAttribute("aria-label",`${u}: ${h}`);const o=Array.from(N.children),l=o[0],a=o[1];if(l){const e=l.querySelector("svg");if(e){const t=Math.max(0,Math.min(100,x)),n=-Math.min(t/100*360,359.999),i=Array.from(e.children),o=i[0];o&&"circle"===o.tagName&&o.setAttribute("fill",v);for(let t=i.length-2;t>=1;t--)e.removeChild(i[t]);if(t>0)if(t>=99.5){const t=document.createElementNS(b,"circle");t.setAttribute("cx",w.toFixed(2)),t.setAttribute("cy",w.toFixed(2)),t.setAttribute("r",(A-3).toFixed(2)),t.setAttribute("fill",f),t.setAttribute("stroke","none"),e.insertBefore(t,e.lastChild)}else{const t=document.createElementNS(b,"path");t.setAttribute("d",k(w,w,A-3,-90,n)),t.setAttribute("fill",f),t.setAttribute("stroke","none"),e.insertBefore(t,e.lastChild);const i=document.createElementNS(b,"path");i.setAttribute("d",C(w,w,A-3,-90,n)),i.setAttribute("fill","none"),i.setAttribute("stroke",f),i.setAttribute("stroke-width","3.5"),e.insertBefore(i,e.lastChild)}}}if(a){const e=Array.from(a.children);let t=i.showUtilizationText?0:-1,n=i.showUtilizationText?1:0;if(i.showUtilizationText&&t>=0&&e[t]){const n=e[t];n.textContent!==y&&(n.textContent=y)}if(e[n]){const t=e[n];t.textContent!==u&&(t.textContent=u)}}r.push({element:N,geometry:s,data:t});continue}N=document.createElement("div"),N.className="parking-lot-map-label",N.setAttribute("role","img"),N.setAttribute("aria-label",`${u}: ${h}`),N.setAttribute("tabindex","-1"),N.setAttribute("data-parking-lot-id",S),N.style.cssText=`\n        position: absolute;\n        left: ${E.x-50}px;\n        top: ${E.y-30}px;\n        background: white;\n        border-radius: 12px;\n        padding: 8px 8px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.15);\n        border: 1px solid #d0d0d0;\n        font-family: 'Avenir Next', 'Helvetica Neue', Arial, sans-serif;\n        z-index: 1000;\n        pointer-events: none;\n        user-select: none;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        min-width: 150px;\n        transform: translateZ(0);\n      `;const M=document.createElement("div");M.style.cssText="\n        position: absolute;\n        bottom: -8px;\n        left: 20px;\n        width: 0;\n        height: 0;\n        border-left: 8px solid transparent;\n        border-right: 8px solid transparent;\n        border-top: 8px solid white;\n        z-index: 1001;\n      ";const F=document.createElement("div");F.style.cssText="\n        position: absolute;\n        bottom: -9px;\n        left: 20px;\n        width: 0;\n        height: 0;\n        border-left: 9px solid transparent;\n        border-right: 9px solid transparent;\n        border-top: 9px solid #d0d0d0;\n        z-index: 1000;\n      ";const z=le(x,f,v),T=document.createElement("div");if(T.style.cssText="\n        display: flex;\n        flex-direction: column;\n        gap: 1px;\n      ",i.showUtilizationText){const e=document.createElement("div");e.textContent=y,e.style.cssText="\n          font-size: 16px;\n          color: #000000;\n          line-height: 1.2;\n          font-weight: 900;\n        ",T.appendChild(e)}const I=document.createElement("div");if(I.textContent=u,I.style.cssText="\n        font-size: 13px;\n        font-weight: 700;\n        color: #000000;\n        line-height: 1.2;\n      ",T.appendChild(I),N.appendChild(z),N.appendChild(T),N.appendChild(F),N.appendChild(M),R)try{m.appendChild(N)}catch(e){continue}r.push({element:N,geometry:s,data:t})}l.forEach(((e,t)=>{o.has(t)||e.parentNode&&e.parentNode.removeChild(e)})),T.current=r,v(r)})),se=e=>x(void 0,void 0,void 0,(function*(){var t;if(!m||!d)return;const n=m.querySelectorAll(".parking-lot-map-label"),o=new Map,r=new Set;n.forEach((e=>{const t=e.getAttribute("data-parking-lot-id");t&&o.set(t,e)}));for(const n of e){const e=Y(n);let l=null!==(t=n.geometry)&&void 0!==t?t:null;if(!l)try{if("function"==typeof n.getJSAPIGeometry)l=n.getJSAPIGeometry();else if("function"==typeof n.getGeometry){const e=n.getGeometry();e&&(l=e)}}catch(e){continue}const{value:a}=Q(e,i.parkingLotField),{value:s}=ee(e),u=X(s);if(!l||!a||!Number.isFinite(u))continue;const c=String(a);r.add(c);const p=o.get(c);if(!p)continue;const f=i.availableColor||"#d638c9",v=i.unavailableColor||"#8B8B8B",m=re(u),h=i.showUtilizationText?m:"";let y=100-u;!i.allowNegatives&&y<0&&(y=0);const g=Math.max(0,Math.min(100,y));try{const e=d.view.toScreen(l),t=e.x-50+"px",n=e.y-30+"px";p.style.left!==t&&(p.style.left=t),p.style.top!==n&&(p.style.top=n)}catch(e){}p.setAttribute("aria-label",`${a}: ${m}`);const x=Array.from(p.children),S=x[0],E=x[1];if(S){const e=S.querySelector("svg");if(e){const t=Math.max(0,Math.min(100,g)),n=Math.min(t/100*360,359.999),i=Array.from(e.children),o=i[0];o&&"circle"===o.tagName&&o.setAttribute("fill",v);for(let t=i.length-2;t>=1;t--)e.removeChild(i[t]);if(t>0)if(t>=99.5){const t=document.createElementNS(b,"circle");t.setAttribute("cx",w.toFixed(2)),t.setAttribute("cy",w.toFixed(2)),t.setAttribute("r",(A-3).toFixed(2)),t.setAttribute("fill",f),t.setAttribute("stroke","none"),e.insertBefore(t,e.lastChild)}else{const t=document.createElementNS(b,"path");t.setAttribute("d",k(w,w,A-3,-90,n)),t.setAttribute("fill",f),t.setAttribute("stroke","none"),e.insertBefore(t,e.lastChild);const i=document.createElementNS(b,"path");i.setAttribute("d",C(w,w,A-3,-90,n)),i.setAttribute("fill","none"),i.setAttribute("stroke",f),i.setAttribute("stroke-width","3.5"),e.insertBefore(i,e.lastChild)}}}if(E){const e=Array.from(E.children);let t=i.showUtilizationText?0:-1,n=i.showUtilizationText?1:0;if(i.showUtilizationText&&t>=0&&e[t]){const n=e[t];n.textContent!==h&&(n.textContent=h)}if(e[n]){const t=e[n];t.textContent!==a&&(t.textContent=a)}}}o.forEach(((e,t)=>{r.has(t)||e.parentNode&&e.parentNode.removeChild(e)}))})),ue=(0,e.jsx)(e.React.Fragment,null,s&&(0,e.jsx)(t.JimuMapViewComponent,{useMapWidgetId:l[0],onActiveViewChange:te}),J?(0,e.jsx)(e.DataSourceComponent,{useDataSource:a,widgetId:o,query:_,onDataSourceInfoChange:oe},(e=>{var t,n,i;const o=null===(t=null==e?void 0:e.getMainDataSource)||void 0===t?void 0:t.call(e),r=null===(n=null==e?void 0:e.getStatus)||void 0===n?void 0:n.call(e),l=null===(i=null==o?void 0:o.getStatus)||void 0===i?void 0:i.call(o),a="UNLOADED"===r&&o&&l&&"UNLOADED"!==l?o:e;return e?(z.current=a,null):null})):null);return c?ue:(0,e.jsx)("div",{ref:F,className:"parking-lot-widget jimu-widget","data-widget-id":o,style:{width:"100%",height:"100%",overflow:"hidden",position:"relative",pointerEvents:"none",userSelect:"none"}},ue,s?u?null:(0,e.jsx)("div",{className:"no-data"},(0,e.jsx)(e.FormattedMessage,{id:"configureDataSource",defaultMessage:g})):(0,e.jsx)("div",{className:"no-data"},(0,e.jsx)(e.FormattedMessage,{id:"selectMap",defaultMessage:"Please select a map widget in the settings"})))};function N(e){o.p=e}})(),r})())}}}));