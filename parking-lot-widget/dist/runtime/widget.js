System.register(["jimu-core","jimu-arcgis"],(function(e,t){var n={},i={};return{setters:[function(e){n.DataSourceComponent=e.DataSourceComponent,n.FormattedMessage=e.FormattedMessage,n.React=e.React,n.jsx=e.jsx,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){i.JimuMapViewComponent=e.JimuMapViewComponent}],execute:function(){e((()=>{var e={56:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{"use strict";var t=[];function n(e){for(var n=-1,i=0;i<t.length;i++)if(t[i].identifier===e){n=i;break}return n}function i(e,i){for(var r={},l=[],a=0;a<e.length;a++){var s=e[a],u=i.base?s[0]+i.base:s[0],c=r[u]||0,d="".concat(u," ").concat(c);r[u]=c+1;var f=n(d),p={css:s[1],media:s[2],sourceMap:s[3],supports:s[4],layer:s[5]};if(-1!==f)t[f].references++,t[f].updater(p);else{var v=o(p,i);i.byIndex=a,t.splice(a,0,{identifier:d,updater:v,references:1})}l.push(d)}return l}function o(e,t){var n=t.domAPI(t);n.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var r=i(e=e||[],o=o||{});return function(e){e=e||[];for(var l=0;l<r.length;l++){var a=n(r[l]);t[a].references--}for(var s=i(e,o),u=0;u<r.length;u++){var c=n(r[u]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}r=s}}},113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},244:e=>{"use strict";e.exports=n},314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",i=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),i&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),i&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,i,o,r){"string"==typeof e&&(e=[[null,e,void 0]]);var l={};if(i)for(var a=0;a<this.length;a++){var s=this[a][0];null!=s&&(l[s]=!0)}for(var u=0;u<e.length;u++){var c=[].concat(e[u]);i&&l[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=r),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),t.push(c))}},t}},400:(e,t,n)=>{"use strict";n.d(t,{A:()=>a});var i=n(601),o=n.n(i),r=n(314),l=n.n(r)()(o());l.push([e.id,'.parking-lot-widget{padding:16px;font-family:"Avenir Next","Helvetica Neue",Arial,sans-serif}.parking-lot-widget,.parking-lot-widget *{pointer-events:none !important;user-select:none !important}.widget-header{margin-bottom:16px}.widget-header h3{margin:0;font-size:18px;font-weight:600;color:#323232}.widget-content{min-height:100px}.parking-lot-list{display:flex;flex-direction:column;gap:12px}.parking-lot-item{background:white;border-radius:8px;padding:10px 12px;box-shadow:0 2px 8px rgba(0, 0, 0, 0.1);border:1px solid #e0e0e0}.parking-lot-content{display:flex;align-items:center;gap:12px;margin-bottom:2px}.utilization-dot{width:20px;height:20px;border-radius:50%;flex-shrink:0;border:2px solid white;box-shadow:0 1px 3px rgba(0, 0, 0, 0.2)}.parking-lot-name{font-size:16px;font-weight:700;color:#323232;line-height:1.3;display:flex;align-items:center}.utilization-text{font-size:14px;color:#666;font-weight:400;margin-left:32px}.no-data{text-align:center;color:#999;font-style:italic;padding:20px;background:#f8f8f8;border-radius:8px;border:1px dashed #ccc}.loading{text-align:center;color:#666;padding:20px;background:#f8f8f8;border-radius:8px;border:1px solid #e0e0e0}@media(max-width: 480px){.parking-lot-widget{padding:12px}.parking-lot-item{padding:10px}.parking-lot-name{font-size:14px}.utilization-text{font-size:12px}}.parking-lot-item:hover{box-shadow:0 4px 12px rgba(0, 0, 0, 0.15);transform:translateY(-1px);transition:all .2s ease}.parking-lot-widget.loading{opacity:.6;pointer-events:none}.parking-lot-widget.loading::after{content:"";position:absolute;top:50%;left:50%;width:20px;height:20px;margin:-10px 0 0 -10px;border:2px solid #f3f3f3;border-top:2px solid #3498db;border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}',""]);const a=l},540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{"use strict";e.exports=function(e){return e[1]}},659:e=>{"use strict";var t={};e.exports=function(e,n){var i=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},686:e=>{"use strict";e.exports=i},825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,o&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(i,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function o(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={id:n,exports:{}};return e[n](r,r.exports,o),r.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="",o.nc=void 0;var r={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(r),o.d(r,{__set_webpack_public_path__:()=>N,default:()=>F});var e=o(244),t=o(686),n=o(72),i=o.n(n),l=o(825),a=o.n(l),s=o(659),u=o.n(s),c=o(56),d=o.n(c),f=o(540),p=o.n(f),v=o(113),m=o.n(v),h=o(400),g={};g.styleTagTransform=m(),g.setAttributes=d(),g.insert=u().bind(null,"head"),g.domAPI=a(),g.insertStyleElement=p();i()(h.A,g);h.A&&h.A.locals&&h.A.locals;const y="Please configure a data source in the widget settings";var x=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function l(e){try{s(i.next(e))}catch(e){r(e)}}function a(e){try{s(i.throw(e))}catch(e){r(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(l,a)}s((i=i.apply(e,t||[])).next())}))};const b="http://www.w3.org/2000/svg",w=50,A=46,S=(e,t,n,i)=>{const o=Math.PI/180*i;return{x:e+n*Math.cos(o),y:t+n*Math.sin(o)}},C=(e,t,n,i,o)=>{const r=i+o,l=S(e,t,n,i),a=S(e,t,n,r),s=Math.abs(o)>180?"1":"0",u=o<0?"0":"1";return["M",l.x.toFixed(2),l.y.toFixed(2),"A",n.toFixed(2),n.toFixed(2),"0",s,u,a.x.toFixed(2),a.y.toFixed(2)].join(" ")},k=(e,t,n,i,o)=>{const r=S(e,t,n,i),l=S(e,t,n,i+o),a=Math.abs(o)>180?"1":"0",s=o<0?"0":"1";return["M",e.toFixed(2),t.toFixed(2),"L",r.x.toFixed(2),r.y.toFixed(2),"A",n.toFixed(2),n.toFixed(2),"0",a,s,l.x.toFixed(2),l.y.toFixed(2),"Z"].join(" ")},F=n=>{const{config:i,id:o,useDataSources:r,useMapWidgetIds:l}=n,a=(null==r?void 0:r[0])||null,s=!!(l&&l.length>0),u=!!a,c=s&&u,[d,f]=e.React.useState(null),[p,v]=e.React.useState([]),[m,h]=e.React.useState(null),[g,S]=e.React.useState(null),[F,N]=e.React.useState(!1),[E,R]=e.React.useState(!0),M=e.React.useRef(null),z=e.React.useRef(null),I=e.React.useRef([]),T=e.React.useRef(null),j=e.React.useRef(null),U=e.React.useRef(!1),D=e.React.useRef(!1),L=e.React.useRef(null),P=e.React.useRef(null),q=e.React.useRef(null),O=e.React.useRef(null),B=e.React.useRef(null),G=(null==a?void 0:a.dataSourceId)||null,$=null!==G&&P.current===G,J=u&&E&&!$,_=e.React.useMemo((()=>({returnGeometry:!0,outFields:["*"]})),[]),K=e.React.useRef(!1),V=e.React.useCallback((e=>{var t;const n=null==l?void 0:l[0],i=null===(t=null==e?void 0:e.view)||void 0===t?void 0:t.container,o=null==i?void 0:i.parentElement,r=n?document.querySelector(`[data-widget-id="${n}"] .map-root`):null,a=n?document.querySelector(`[data-widget-id="${n}"] .esri-view-root`):null,s=n?document.querySelector(`[data-widget-id="${n}"] .esri-view`):null,u=n?document.querySelector(`[data-widget-id="${n}"]`):null;return i||o||a||s||r||u||null}),[l]),H=e.React.useCallback((e=>{if(!e)return;e.querySelectorAll(".parking-lot-map-label").forEach((e=>{e.parentNode&&e.parentNode.removeChild(e)}))}),[]),W=e.React.useCallback((()=>{var e;H(m);const t=null===(e=null==d?void 0:d.view)||void 0===e?void 0:e.container;t&&t!==m&&H(t)}),[m,d,H]),Z=e.React.useCallback((e=>{var t,n,i;if(!e)return null;if(null===(t=null==e?void 0:e.feature)||void 0===t?void 0:t.geometry)return e.feature;if((null===(n=null==e?void 0:e.feature)||void 0===n?void 0:n.attributes)&&"function"==typeof(null==e?void 0:e.getJSAPIGeometry)){const t=e.getJSAPIGeometry();if(t)return{geometry:t,attributes:e.feature.attributes}}if("function"==typeof(null==e?void 0:e.getJSAPIGeometry)){const t=e.getJSAPIGeometry(),n=(null===(i=e.getData)||void 0===i?void 0:i.call(e))||{};if(t)return{geometry:t,attributes:n}}return(null==e?void 0:e.attributes)&&(null==e?void 0:e.geometry)?e:null}),[]),Y=e.React.useCallback((e=>{var t;if(!e)return null;const n="function"==typeof(null==e?void 0:e.getData)&&e.getData()||null,i=(null===(t=null==e?void 0:e.feature)||void 0===t?void 0:t.attributes)||null,o=(null==e?void 0:e.attributes)||null,r={},l=e=>{e&&"object"==typeof e&&Object.keys(e).forEach((t=>{const n=e[t];null!=n?r[t]=n:t in r||(r[t]=n)}))};return l(i),l(o),l(n),Object.keys(r).length>0?r:null}),[]),Q=e.React.useCallback(((e,t)=>{if(!e||!t)return{value:void 0,resolvedKey:null};if(Object.prototype.hasOwnProperty.call(e,t))return{value:e[t],resolvedKey:t};const n=t.toLowerCase(),i=Object.keys(e),o=i.find((e=>e.toLowerCase().startsWith(n)));if(o)return{value:e[o],resolvedKey:o};const r=i.find((e=>n.startsWith(e.toLowerCase())));if(r)return{value:e[r],resolvedKey:r};const l=i.find((e=>e.toLowerCase().includes(n)));return l?{value:e[l],resolvedKey:l}:{value:void 0,resolvedKey:null}}),[]),X=e.React.useCallback((e=>{if("number"==typeof e)return Number.isFinite(e)?e:NaN;if("string"==typeof e){const t=e.trim().replace("%",""),n=Number(t);if(Number.isFinite(n))return n;const i=Number.parseFloat(t);return Number.isFinite(i)?i:NaN}const t=Number(e);return Number.isFinite(t)?t:NaN}),[]),ee=e.React.useCallback((e=>{const t=Q(e,i.utilizationField);if(Number.isFinite(X(t.value)))return t;if(!e)return t;const n=Object.keys(e).filter((e=>{const t=e.toLowerCase();return t.includes("util")||t.includes("occup")||t.includes("usage")}));for(const t of n){const n=e[t];if(Number.isFinite(X(n)))return{value:n,resolvedKey:t}}return t}),[Q,X,i.utilizationField]),te=e.React.useCallback((e=>{if(e){f(e);const t=V(e);t&&(t.tagName,t.className,h(t))}}),[V]);e.React.useEffect((()=>{if(m||!(null==d?void 0:d.view))return;const e=V(d);e&&(e.tagName,e.className,h(e))}),[d,m,V]),e.React.useEffect((()=>{var e;const t=null===(e=null==d?void 0:d.view)||void 0===e?void 0:e.container;t&&t!==m&&("undefined"==typeof document||document.contains(t))&&h(t)}),[d,m]),e.React.useEffect((()=>{if(!m)return;"static"===window.getComputedStyle(m).position&&(m.style.position="relative"),m.style.userSelect="none",m.style.webkitUserSelect="none",m.style.msUserSelect="none"}),[m]),e.React.useEffect((()=>{var e,t,n,i,o,r,l,a,s,u,c,d;if(!m)return;const f=m.closest(".map-base"),p=m.querySelector(".esri-view-surface"),v=m.querySelector("canvas"),h=null!==(e=null==f?void 0:f.style.pointerEvents)&&void 0!==e?e:"",g=null!==(t=null==f?void 0:f.style.position)&&void 0!==t?t:"",y=null!==(n=null==f?void 0:f.style.zIndex)&&void 0!==n?n:"",x=null!==(i=m.style.position)&&void 0!==i?i:"",b=null!==(o=m.style.zIndex)&&void 0!==o?o:"",w=null!==(r=m.style.pointerEvents)&&void 0!==r?r:"",A=null!==(l=null==p?void 0:p.style.pointerEvents)&&void 0!==l?l:"",S=null!==(a=null==p?void 0:p.style.position)&&void 0!==a?a:"",C=null!==(s=null==p?void 0:p.style.zIndex)&&void 0!==s?s:"",k=null!==(u=null==v?void 0:v.style.pointerEvents)&&void 0!==u?u:"",F=null!==(c=null==v?void 0:v.style.position)&&void 0!==c?c:"",N=null!==(d=null==v?void 0:v.style.zIndex)&&void 0!==d?d:"";return f&&(f.style.pointerEvents="auto","static"===window.getComputedStyle(f).position&&(f.style.position="relative"),f.style.zIndex="0"),"static"===window.getComputedStyle(m).position&&(m.style.position="relative"),m.style.pointerEvents="auto",m.style.zIndex="2",p&&(p.style.pointerEvents="auto",p.style.position="relative",p.style.zIndex="3"),v&&(v.style.pointerEvents="auto",v.style.position="relative",v.style.zIndex="4"),()=>{f&&(f.style.pointerEvents=h),f&&(f.style.position=g),f&&(f.style.zIndex=y),m.style.position=x,m.style.zIndex=b,m.style.pointerEvents=w,p&&(p.style.pointerEvents=A),p&&(p.style.position=S),p&&(p.style.zIndex=C),v&&(v.style.pointerEvents=k),v&&(v.style.position=F),v&&(v.style.zIndex=N)}}),[m]),e.React.useLayoutEffect((()=>{if(M.current)return()=>{}}),[o]),e.React.useEffect((()=>{var e;const t=null===(e=null==d?void 0:d.view)||void 0===e?void 0:e.container;if(!t)return;const n=document.querySelector(`[data-widgetid="${o}"]`),i=t.closest(".map-base"),r=[],l=e=>{e&&(r.push({el:e,prev:e.style.pointerEvents||""}),e.style.pointerEvents="auto")};return l(n),l(i),l(t),()=>{r.forEach((({el:e,prev:t})=>{e.style.pointerEvents=t}))}}),[o,d]),e.React.useEffect((()=>{if(d&&p.length>0){const e=()=>{const e=d.view.zoom,t=Math.max(.3,Math.min(1,(e-10)/8));p.forEach((e=>{try{const n=d.view.toScreen(e.geometry);if(e.element){e.element.style.transform=`scale(${t}) translateZ(0)`,e.element.style.transformOrigin="20px bottom";const i=e.element.offsetHeight||60;e.element.style.left=n.x-20+"px",e.element.style.top=n.y-i-8+"px"}}catch(e){}}))},t=()=>{null===T.current&&(T.current=window.requestAnimationFrame((()=>{T.current=null,e()})))},n=[d.view.watch("extent",t),d.view.watch("center",t),d.view.watch("zoom",t)],i=d.view;"function"==typeof(null==i?void 0:i.watch)&&(null!=i.width&&n.push(i.watch("width",t)),null!=i.height&&n.push(i.watch("height",t)));const o=(null==i?void 0:i.container)||m;let r=null;"undefined"!=typeof ResizeObserver&&o&&(r=new ResizeObserver((()=>t())),r.observe(o)),t();let l=window.requestAnimationFrame((()=>{e(),l=null}));const a="undefined"!=typeof window&&/Mobi|Android|iPhone|iPad/i.test(window.navigator.userAgent),s="undefined"!=typeof window&&window.self!==window.top,u=a||s?window.setTimeout((()=>t()),400):null;return()=>{null!=u&&window.clearTimeout(u),null==r||r.disconnect(),null!=l&&window.cancelAnimationFrame(l),null!==T.current&&(window.cancelAnimationFrame(T.current),T.current=null),n.forEach((e=>{e&&"function"==typeof e.remove&&e.remove()}))}}}),[d,p,m]),e.React.useEffect((()=>()=>{p.forEach((e=>{e.element&&e.element.parentNode&&e.element.parentNode.removeChild(e.element)}))}),[p]),e.React.useEffect((()=>{if(!K.current)return void(K.current=!0);W(),v([]),N(!0),R(!0),z.current=null,j.current=null,U.current=!1,D.current=!1,L.current=null,P.current=null,q.current=null,O.current=null}),[W,i.parkingLotField,i.utilizationField,i.showUtilizationText,i.allowNegatives,i.fullThreshold,i.availableColor,i.unavailableColor]),e.React.useEffect((()=>{if(!r||0===r.length)return S(null),N(!1),R(!1),L.current=null,P.current=null,q.current=null,void(O.current=null);const e=G;null===g&&!!e&&P.current!==e&&O.current!==e&&(O.current=e,R(!0),N(!0),L.current=null,z.current=null,q.current=null),null!==g&&e!==g&&(z.current=null,W(),v([]),j.current=null,U.current=!1,D.current=!1,L.current=null,P.current=null,O.current=null,N(!0),R(!0),q.current=null),g!==e&&S(e)}),[G,g,W,m]);const ne=e.React.useCallback((e=>{null==e||e.reason;return N(!0),!0}),[]),ie=e.React.useCallback((e=>{var t;if(!m)return;const n=m.querySelectorAll(".parking-lot-map-label");if(0===n.length)return;const o=new Map;n.forEach((e=>{const t=e.getAttribute("data-parking-lot-id");t&&o.set(t,e)}));for(const n of e){const e=Y(n);if(!e)continue;const{value:r}=Q(e,i.parkingLotField),{value:l}=ee(e);if(!r)continue;const a=String(r),s=o.get(a);if(!s)continue;const u=X(l);if(!Number.isFinite(u)){s.parentNode&&s.parentNode.removeChild(s);continue}const c=Number.isFinite(u)?u:0,d=i.availableColor||"#d638c9",f=i.unavailableColor||"#8B8B8B",p=Math.max(0,Math.min(100,null!==(t=i.fullThreshold)&&void 0!==t?t:95));let v=100-c;!i.allowNegatives&&v<0&&(v=0);const m=c>=p||v<=Math.max(0,100-p)?"Full":`${Math.round(Math.max(0,Math.min(100,v)))}% Available`,h=i.showUtilizationText?m:"";let g=100-c;!i.allowNegatives&&g<0&&(g=0);const y=Math.max(0,Math.min(100,g));s.setAttribute("aria-label",`${r}: ${m}`);const x=Array.from(s.children),S=x[0],F=x[1];if(S){const e=S.querySelector("svg");if(e){const t=Math.max(0,Math.min(100,y)),n=-Math.min(t/100*360,359.999),i=Array.from(e.children),o=i[0];o&&"circle"===o.tagName&&o.setAttribute("fill",f);for(let t=i.length-2;t>=1;t--)e.removeChild(i[t]);if(t>0)if(t>=99.5){const t=document.createElementNS(b,"circle");t.setAttribute("cx",w.toFixed(2)),t.setAttribute("cy",w.toFixed(2)),t.setAttribute("r",(A-3).toFixed(2)),t.setAttribute("fill",d),t.setAttribute("stroke","none"),e.insertBefore(t,e.lastChild)}else{const t=document.createElementNS(b,"path");t.setAttribute("d",k(w,w,A-3,-90,n)),t.setAttribute("fill",d),t.setAttribute("stroke","none"),e.insertBefore(t,e.lastChild);const i=document.createElementNS(b,"path");i.setAttribute("d",C(w,w,A-3,-90,n)),i.setAttribute("fill","none"),i.setAttribute("stroke",d),i.setAttribute("stroke-width","3.5"),e.insertBefore(i,e.lastChild)}}}if(F){const e=Array.from(F.children);let t=i.showUtilizationText?0:-1,n=i.showUtilizationText?1:0;if(i.showUtilizationText&&t>=0&&e[t]){const n=e[t];n.textContent!==h&&(n.textContent=h)}if(e[n]){const t=e[n];t.textContent!==r&&(t.textContent=r)}}}}),[m,Y,Q,X,i.parkingLotField,i.utilizationField,i.availableColor,i.unavailableColor,i.allowNegatives,i.showUtilizationText,i.fullThreshold]);e.React.useEffect((()=>{var e,t,n,o;if(!F)return;if(null===(e=null==d?void 0:d.view)||void 0===e||e.ready,!(null===(t=null==d?void 0:d.view)||void 0===t?void 0:t.ready))return null===(n=null==d?void 0:d.view)||void 0===n||n.ready,void N(!1);if(!g)return void N(!1);if(!m)return void N(!1);const r=z.current,l=G;if(!r||!l||g!==l)return void N(!1);const a=null===(o=r.getStatus)||void 0===o?void 0:o.call(r);if("LOADED"!==a)return void N(!1);if(U.current||D.current)return U.current,void D.current;L.current=l;let s=!1;return U.current=!0,D.current=!0,x(void 0,void 0,void 0,(function*(){var e;try{let t=0,n=0;const o=()=>x(void 0,void 0,void 0,(function*(){var e,o;const a=(null===(e=null==r?void 0:r.getRecords)||void 0===e?void 0:e.call(r))||[],s=a.slice(0,1e3);if(t=s.length,B.current!==l){const e=s.slice(0,5).map(((e,t)=>{const n=Y(e),o=ee(n),r=o.value,l=X(r);return{index:t,parkingLot:Q(n,i.parkingLotField).value,rawUtilization:r,resolvedUtilizationField:o.resolvedKey,rawType:typeof r,parsedUtilization:l,parsedIsFinite:Number.isFinite(l)}})),t=s.reduce(((e,t)=>{const n=Y(t),i=ee(n);return Number.isFinite(X(i.value))?e+1:e}),0);n=t,console.log("[parking-lot-widget][diag] utilization field probe",{dsId:l,parkingLotField:i.parkingLotField,utilizationField:i.utilizationField,recordsCount:s.length,finiteUtilizationCount:t,nonFiniteUtilizationCount:Math.max(0,s.length-t),sample:e}),B.current=l}else n=s.reduce(((e,t)=>{const n=Y(t),o=Q(n,i.utilizationField);return Number.isFinite(X(o.value))?e+1:e}),0);const u=s.map((e=>Z(e))).filter((e=>e)),c=u.filter((e=>null==e?void 0:e.geometry));if(a.length,u.length,c.length,i.parkingLotField,i.utilizationField,a.length>0){const e=a[0],t="function"==typeof(null==e?void 0:e.getData)?e.getData():(null==e?void 0:e.attributes)||(null===(o=null==e?void 0:e.feature)||void 0===o?void 0:o.attributes);null==e||e.getData,null==e||e.getJSAPIGeometry,t&&Object.keys(t),i.parkingLotField,null==t||t[i.parkingLotField],i.utilizationField,null==t||t[i.utilizationField]}return a.length,s.length,c.length,c})),a=yield o();if(a.length,a.length,s)return;if(t>0&&0===n)return W(),v([]),N(!1),R(!1),void(P.current=l);if(0===a.length){const t=((null===(e=null==r?void 0:r.getRecords)||void 0===e?void 0:e.call(r))||[]).slice(0,1e3),n=t.length>0;return m.querySelectorAll(".parking-lot-map-label").length,t.length,n&&(ie(t),t.length),N(!1),n?(R(!1),void(P.current=l)):void(L.current=null)}const u=m.querySelectorAll(".parking-lot-map-label").length,c=0===u;if(a.length,c){a.length,yield ae(a);const e=m.querySelectorAll(".parking-lot-map-label").length;e>0&&(j.current=l)}else a.length,yield se(a);N(!1),R(!1),P.current=l,m.querySelectorAll(".parking-lot-map-label").length}catch(e){String(e),N(!1)}finally{U.current=!1,D.current=!1}})),()=>{s=!0}}),[F,d,g,G,m,i.parkingLotField,i.utilizationField,i.showUtilizationText,i.allowNegatives,i.fullThreshold,i.availableColor,i.unavailableColor,Z,ie,Q,X]);const oe=e.React.useCallback(((e,t)=>{if(null==e||e.status,null==t||t.status,null==e||e.sourceVersion,null==t||t.sourceVersion,null==e||e.needRefresh,null==t||t.needRefresh,null==e||e.sourceVersion,null==e||e.status,null==t||t.status,null==t||t.sourceVersion,L.current,!e)return;const n=G;if(!n)return;if("LOAD_ERROR"===e.status)return N(!1),R(!1),void(P.current=n);"LOADED"===e.status&&L.current!==n&&P.current!==n&&ne({reason:"data-source-initial-loaded"})}),[G,ne]),re=e=>{var t;const n=Math.max(0,Math.min(100,null!==(t=i.fullThreshold)&&void 0!==t?t:95));let o=100-e;if(!i.allowNegatives&&o<0&&(o=0),e>=n||o<=Math.max(0,100-n))return"Full";const r=Math.max(0,Math.min(100,o));return`${Math.round(r)}% Available`},le=(e,t,n)=>{const i=Math.max(0,Math.min(100,e)),o=-Math.min(i/100*360,359.999),r=document.createElement("div");r.style.cssText="\n      width: 44px;\n      height: 44px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      flex-shrink: 0;\n      pointer-events: none;\n    ",r.setAttribute("aria-hidden","true");const l=document.createElementNS(b,"svg");l.setAttribute("width","44"),l.setAttribute("height","44"),l.setAttribute("viewBox","0 0 100 100"),l.style.display="block",l.style.flexShrink="0",l.style.pointerEvents="none",l.setAttribute("role","presentation"),l.setAttribute("focusable","false");const a=document.createElementNS(b,"circle");if(a.setAttribute("cx",w.toFixed(2)),a.setAttribute("cy",w.toFixed(2)),a.setAttribute("r",A.toFixed(2)),a.setAttribute("fill",n),a.setAttribute("stroke","none"),l.appendChild(a),i>0)if(i>=99.5){const e=document.createElementNS(b,"circle");e.setAttribute("cx",w.toFixed(2)),e.setAttribute("cy",w.toFixed(2)),e.setAttribute("r",(A-3).toFixed(2)),e.setAttribute("fill",t),e.setAttribute("stroke","none"),l.appendChild(e)}else{const e=document.createElementNS(b,"path");e.setAttribute("d",k(w,w,A-3,-90,o)),e.setAttribute("fill",t),e.setAttribute("stroke","none"),l.appendChild(e);const n=document.createElementNS(b,"path");n.setAttribute("d",C(w,w,A-3,-90,o)),n.setAttribute("fill","none"),n.setAttribute("stroke",t),n.setAttribute("stroke-width","3.5"),l.appendChild(n)}const s=document.createElementNS(b,"circle");return s.setAttribute("cx",w.toFixed(2)),s.setAttribute("cy",w.toFixed(2)),s.setAttribute("r",(A-1.5).toFixed(2)),s.setAttribute("fill","none"),s.setAttribute("stroke","#333333"),s.setAttribute("stroke-width","3"),l.appendChild(s),r.appendChild(l),r},ae=t=>x(void 0,void 0,void 0,(function*(){if(null==t||t.length,!m||!d)return;let n=null;try{n=(yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/projection","esri/geometry/Point","esri/geometry/SpatialReference"]))[0],yield n.load()}catch(e){}const o=new Set,r=[],l=new Map;m.querySelectorAll(".parking-lot-map-label").forEach((e=>{const t=e.getAttribute("data-parking-lot-id");t&&l.set(t,e)}));const a={};for(const e of t){let t,s=null;if("function"==typeof e.getData){t=e.getData();try{if("function"==typeof e.getJSAPIGeometry)s=e.getJSAPIGeometry();else if("function"==typeof e.getGeometry){const t=e.getGeometry();t&&(s=t)}}catch(e){}}else e.attributes&&e.geometry?(t=e.attributes,s=e.geometry):(t=e.data||e.attributes||e,s=e.geometry||e.geom||null);const{value:u}=Q(t,i.parkingLotField),{value:c}=ee(t);if(!s){a.noGeometry=(a.noGeometry||0)+1;continue}if(!u){a.noName=(a.noName||0)+1;continue}const f=X(c);if(!Number.isFinite(f)){a.noUtilization=(a.noUtilization||0)+1;continue}const p=Number.isFinite(f)?f:0,v=i.availableColor||"#d638c9",h=i.unavailableColor||"#8B8B8B",g=re(p),y=i.showUtilizationText?g:"";let x=100-p;!i.allowNegatives&&x<0&&(x=0);const S=Math.max(0,Math.min(100,x)),F=String(u);o.add(F);try{const e=d.view.spatialReference,t=s.spatialReference;if(n&&t&&e&&t.wkid!==e.wkid){const t=n.project(s,e);t&&(s=t)}}catch(e){}let N;try{N=d.view.toScreen(s)}catch(e){a.coordError=(a.coordError||0)+1;continue}let E=l.get(F);const R=!E;if(E){const e=N.x-50+"px",n=N.y-30+"px";E.style.left!==e&&(E.style.left=e),E.style.top!==n&&(E.style.top=n),E.setAttribute("aria-label",`${u}: ${g}`);const o=Array.from(E.children),l=o[0],a=o[1];if(l){const e=l.querySelector("svg");if(e){const t=Math.max(0,Math.min(100,S)),n=-Math.min(t/100*360,359.999),i=Array.from(e.children),o=i[0];o&&"circle"===o.tagName&&o.setAttribute("fill",h);for(let t=i.length-2;t>=1;t--)e.removeChild(i[t]);if(t>0)if(t>=99.5){const t=document.createElementNS(b,"circle");t.setAttribute("cx",w.toFixed(2)),t.setAttribute("cy",w.toFixed(2)),t.setAttribute("r",(A-3).toFixed(2)),t.setAttribute("fill",v),t.setAttribute("stroke","none"),e.insertBefore(t,e.lastChild)}else{const t=document.createElementNS(b,"path");t.setAttribute("d",k(w,w,A-3,-90,n)),t.setAttribute("fill",v),t.setAttribute("stroke","none"),e.insertBefore(t,e.lastChild);const i=document.createElementNS(b,"path");i.setAttribute("d",C(w,w,A-3,-90,n)),i.setAttribute("fill","none"),i.setAttribute("stroke",v),i.setAttribute("stroke-width","3.5"),e.insertBefore(i,e.lastChild)}}}if(a){const e=Array.from(a.children);let t=i.showUtilizationText?0:-1,n=i.showUtilizationText?1:0;if(i.showUtilizationText&&t>=0&&e[t]){const n=e[t];n.textContent!==y&&(n.textContent=y)}if(e[n]){const t=e[n];t.textContent!==u&&(t.textContent=u)}}r.push({element:E,geometry:s,data:t});continue}E=document.createElement("div"),E.className="parking-lot-map-label",E.setAttribute("role","img"),E.setAttribute("aria-label",`${u}: ${g}`),E.setAttribute("tabindex","-1"),E.setAttribute("data-parking-lot-id",F),E.style.cssText=`\n        position: absolute;\n        left: ${N.x-50}px;\n        top: ${N.y-30}px;\n        background: white;\n        border-radius: 12px;\n        padding: 8px 8px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.15);\n        border: 1px solid #d0d0d0;\n        font-family: 'Avenir Next', 'Helvetica Neue', Arial, sans-serif;\n        z-index: 1000;\n        pointer-events: none;\n        user-select: none;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        min-width: 150px;\n        transform: translateZ(0);\n        -webkit-transform: translateZ(0);\n      `;const M=document.createElement("div");M.style.cssText="\n        position: absolute;\n        bottom: -8px;\n        left: 20px;\n        width: 0;\n        height: 0;\n        border-left: 8px solid transparent;\n        border-right: 8px solid transparent;\n        border-top: 8px solid white;\n        z-index: 1001;\n      ";const z=document.createElement("div");z.style.cssText="\n        position: absolute;\n        bottom: -9px;\n        left: 20px;\n        width: 0;\n        height: 0;\n        border-left: 9px solid transparent;\n        border-right: 9px solid transparent;\n        border-top: 9px solid #d0d0d0;\n        z-index: 1000;\n      ";const I=le(S,v,h),T=document.createElement("div");if(T.style.cssText="\n        display: flex;\n        flex-direction: column;\n        gap: 1px;\n      ",i.showUtilizationText){const e=document.createElement("div");e.textContent=y,e.style.cssText="\n          font-size: 16px;\n          color: #000000;\n          line-height: 1.2;\n          font-weight: 900;\n        ",T.appendChild(e)}const j=document.createElement("div");j.textContent=u,j.style.cssText="\n        font-size: 13px;\n        font-weight: 700;\n        color: #000000;\n        line-height: 1.2;\n      ",T.appendChild(j),E.appendChild(I),E.appendChild(T),E.appendChild(z),E.appendChild(M);E.childNodes.length;if(R)try{m.appendChild(E)}catch(e){continue}else E.childNodes.length,T.textContent;r.push({element:E,geometry:s,data:t})}l.forEach(((e,t)=>{o.has(t)||e.parentNode&&e.parentNode.removeChild(e)}));m.querySelectorAll(".parking-lot-map-label").length;r.length,r.filter((e=>!l.has(e.element.getAttribute("data-parking-lot-id")||""))).length,r.filter((e=>l.has(e.element.getAttribute("data-parking-lot-id")||""))).length,m&&m.tagName,t.length,I.current=r,v(r)})),se=e=>x(void 0,void 0,void 0,(function*(){if(null==e||e.length,!m||!d)return;const t=m.querySelectorAll(".parking-lot-map-label"),n=new Map,o=new Set;t.forEach((e=>{const t=e.getAttribute("data-parking-lot-id");t&&n.set(t,e)})),n.size,e.length;for(const t of e){let e,r=null;if("function"==typeof t.getData){e=t.getData();try{if("function"==typeof t.getJSAPIGeometry)r=t.getJSAPIGeometry();else if("function"==typeof t.getGeometry){const e=t.getGeometry();e&&(r=e)}}catch(e){continue}}else t.attributes&&t.geometry?(e=t.attributes,r=t.geometry):(e=t.data||t.attributes||t,r=t.geometry||t.geom||null);const{value:l}=Q(e,i.parkingLotField),{value:a}=ee(e);if(!r||!l)continue;const s=String(l);o.add(s);const u=n.get(s);if(!u)continue;const c=X(a);if(!Number.isFinite(c)){u.parentNode&&u.parentNode.removeChild(u);continue}const f=Number.isFinite(c)?c:0,p=i.availableColor||"#d638c9",v=i.unavailableColor||"#8B8B8B",m=re(f),h=i.showUtilizationText?m:"";let g=100-f;!i.allowNegatives&&g<0&&(g=0);const y=Math.max(0,Math.min(100,g));try{const e=d.view.toScreen(r),t=e.x-50+"px",n=e.y-30+"px";u.style.left!==t&&(u.style.left=t),u.style.top!==n&&(u.style.top=n)}catch(e){}u.setAttribute("aria-label",`${l}: ${m}`);const x=Array.from(u.children),S=x[0],F=x[1];if(S){const e=S.querySelector("svg");if(e){const t=Math.max(0,Math.min(100,y)),n=Math.min(t/100*360,359.999),i=Array.from(e.children),o=i[0];o&&"circle"===o.tagName&&o.setAttribute("fill",v);for(let t=i.length-2;t>=1;t--)e.removeChild(i[t]);if(t>0)if(t>=99.5){const t=document.createElementNS(b,"circle");t.setAttribute("cx",w.toFixed(2)),t.setAttribute("cy",w.toFixed(2)),t.setAttribute("r",(A-3).toFixed(2)),t.setAttribute("fill",p),t.setAttribute("stroke","none"),e.insertBefore(t,e.lastChild)}else{const t=document.createElementNS(b,"path");t.setAttribute("d",k(w,w,A-3,-90,n)),t.setAttribute("fill",p),t.setAttribute("stroke","none"),e.insertBefore(t,e.lastChild);const i=document.createElementNS(b,"path");i.setAttribute("d",C(w,w,A-3,-90,n)),i.setAttribute("fill","none"),i.setAttribute("stroke",p),i.setAttribute("stroke-width","3.5"),e.insertBefore(i,e.lastChild)}}}if(F){const e=Array.from(F.children);let t=i.showUtilizationText?0:-1,n=i.showUtilizationText?1:0;if(i.showUtilizationText&&t>=0&&e[t]){const n=e[t];n.textContent!==h&&(n.textContent=h)}if(e[n]){const t=e[n];t.textContent!==l&&(t.textContent=l)}}}n.forEach(((e,t)=>{o.has(t)||e.parentNode&&e.parentNode.removeChild(e)})),o.size,n.size,o.size})),ue=(0,e.jsx)(e.React.Fragment,null,s&&(0,e.jsx)(t.JimuMapViewComponent,{useMapWidgetId:l[0],onActiveViewChange:te}),J?(0,e.jsx)(e.DataSourceComponent,{useDataSource:a,widgetId:o,query:_,onDataSourceInfoChange:oe},(e=>{var t,n,i,o,l,a,s;const u=null===(t=null==e?void 0:e.getMainDataSource)||void 0===t?void 0:t.call(e),c=null===(n=null==e?void 0:e.getStatus)||void 0===n?void 0:n.call(e),d=null===(i=null==u?void 0:u.getStatus)||void 0===i?void 0:i.call(u),f="UNLOADED"===c&&u&&d&&"UNLOADED"!==d?u:e;f&&(null==f?void 0:f.getRecords)&&(f.getRecords()||[]).length;return String((null===(o=null==f?void 0:f.getError)||void 0===o?void 0:o.call(f))||(null===(l=null==e?void 0:e.getError)||void 0===l?void 0:l.call(e))||""),null===(a=null==r?void 0:r[0])||void 0===a||a.dataSourceId,e?(z.current=f,null==f||f.id,null==f||f.type,null===(s=null==f?void 0:f.getStatus)||void 0===s||s.call(f),null):null})):null);return c?ue:(0,e.jsx)("div",{ref:M,className:"parking-lot-widget jimu-widget","data-widget-id":o,style:{width:"100%",height:"100%",overflow:"hidden",position:"relative",pointerEvents:"none",userSelect:"none"}},ue,s?u?null:(0,e.jsx)("div",{className:"no-data"},(0,e.jsx)(e.FormattedMessage,{id:"configureDataSource",defaultMessage:y})):(0,e.jsx)("div",{className:"no-data"},(0,e.jsx)(e.FormattedMessage,{id:"selectMap",defaultMessage:"Please select a map widget in the settings"})))};function N(e){o.p=e}})(),r})())}}}));