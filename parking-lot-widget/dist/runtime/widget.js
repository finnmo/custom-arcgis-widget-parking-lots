System.register(["jimu-core","jimu-arcgis"],(function(t,e){var n={},i={};return{setters:[function(t){n.DataSourceComponent=t.DataSourceComponent,n.FormattedMessage=t.FormattedMessage,n.React=t.React,n.jsx=t.jsx,n.loadArcGISJSAPIModules=t.loadArcGISJSAPIModules},function(t){i.JimuMapViewComponent=t.JimuMapViewComponent}],execute:function(){t((()=>{var t={56:(t,e,n)=>{"use strict";t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},72:t=>{"use strict";var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var r={},l=[],a=0;a<t.length;a++){var s=t[a],c=i.base?s[0]+i.base:s[0],u=r[c]||0,d="".concat(c," ").concat(u);r[c]=u+1;var f=n(d),p={css:s[1],media:s[2],sourceMap:s[3],supports:s[4],layer:s[5]};if(-1!==f)e[f].references++,e[f].updater(p);else{var h=o(p,i);i.byIndex=a,e.splice(a,0,{identifier:d,updater:h,references:1})}l.push(d)}return l}function o(t,e){var n=e.domAPI(e);n.update(t);return function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,o){var r=i(t=t||[],o=o||{});return function(t){t=t||[];for(var l=0;l<r.length;l++){var a=n(r[l]);e[a].references--}for(var s=i(t,o),c=0;c<r.length;c++){var u=n(r[c]);0===e[u].references&&(e[u].updater(),e.splice(u,1))}r=s}}},113:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},244:t=>{"use strict";t.exports=n},314:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,i,o,r){"string"==typeof t&&(t=[[null,t,void 0]]);var l={};if(i)for(var a=0;a<this.length;a++){var s=this[a][0];null!=s&&(l[s]=!0)}for(var c=0;c<t.length;c++){var u=[].concat(t[c]);i&&l[u[0]]||(void 0!==r&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=r),n&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=n):u[2]=n),o&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=o):u[4]="".concat(o)),e.push(u))}},e}},400:(t,e,n)=>{"use strict";n.d(e,{A:()=>a});var i=n(601),o=n.n(i),r=n(314),l=n.n(r)()(o());l.push([t.id,'.parking-lot-widget{padding:16px;font-family:"Avenir Next","Helvetica Neue",Arial,sans-serif}.widget-header{margin-bottom:16px}.widget-header h3{margin:0;font-size:18px;font-weight:600;color:#323232}.widget-content{min-height:100px}.parking-lot-list{display:flex;flex-direction:column;gap:12px}.parking-lot-item{background:white;border-radius:8px;padding:10px 12px;box-shadow:0 2px 8px rgba(0, 0, 0, 0.1);border:1px solid #e0e0e0}.parking-lot-content{display:flex;align-items:center;gap:12px;margin-bottom:2px}.utilization-dot{width:20px;height:20px;border-radius:50%;flex-shrink:0;border:2px solid white;box-shadow:0 1px 3px rgba(0, 0, 0, 0.2)}.parking-lot-name{font-size:16px;font-weight:700;color:#323232;line-height:1.3;display:flex;align-items:center}.utilization-text{font-size:14px;color:#666;font-weight:400;margin-left:32px}.no-data{text-align:center;color:#999;font-style:italic;padding:20px;background:#f8f8f8;border-radius:8px;border:1px dashed #ccc}.loading{text-align:center;color:#666;padding:20px;background:#f8f8f8;border-radius:8px;border:1px solid #e0e0e0}@media(max-width: 480px){.parking-lot-widget{padding:12px}.parking-lot-item{padding:10px}.parking-lot-name{font-size:14px}.utilization-text{font-size:12px}}.parking-lot-item:hover{box-shadow:0 4px 12px rgba(0, 0, 0, 0.15);transform:translateY(-1px);transition:all .2s ease}.parking-lot-widget.loading{opacity:.6;pointer-events:none}.parking-lot-widget.loading::after{content:"";position:absolute;top:50%;left:50%;width:20px;height:20px;margin:-10px 0 0 -10px;border:2px solid #f3f3f3;border-top:2px solid #3498db;border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}',""]);const a=l},540:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},601:t=>{"use strict";t.exports=function(t){return t[1]}},659:t=>{"use strict";var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},686:t=>{"use strict";t.exports=i},825:t=>{"use strict";t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,o&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}}},e={};function o(n){var i=e[n];if(void 0!==i)return i.exports;var r=e[n]={id:n,exports:{}};return t[n](r,r.exports,o),r.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.p="",o.nc=void 0;var r={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(r),o.d(r,{__set_webpack_public_path__:()=>F,default:()=>N});var t=o(244),e=o(686),n=o(72),i=o.n(n),l=o(825),a=o.n(l),s=o(659),c=o.n(s),u=o(56),d=o.n(u),f=o(540),p=o.n(f),h=o(113),m=o.n(h),g=o(400),v={};v.styleTagTransform=m(),v.setAttributes=d(),v.insert=c().bind(null,"head"),v.domAPI=a(),v.insertStyleElement=p();i()(g.A,v);g.A&&g.A.locals&&g.A.locals;const x="Please configure a data source in the widget settings";var b=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function l(t){try{s(i.next(t))}catch(t){r(t)}}function a(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(l,a)}s((i=i.apply(t,e||[])).next())}))};const y="http://www.w3.org/2000/svg",A=50,w=46,S=(t,e,n,i)=>{const o=Math.PI/180*i;return{x:t+n*Math.cos(o),y:e+n*Math.sin(o)}},C=(t,e,n,i,o)=>{const r=i+o,l=S(t,e,n,i),a=S(t,e,n,r),s=Math.abs(o)>180?"1":"0",c=o<0?"0":"1";return["M",l.x.toFixed(2),l.y.toFixed(2),"A",n.toFixed(2),n.toFixed(2),"0",s,c,a.x.toFixed(2),a.y.toFixed(2)].join(" ")},k=(t,e,n,i,o)=>{const r=S(t,e,n,i),l=S(t,e,n,i+o),a=Math.abs(o)>180?"1":"0",s=o<0?"0":"1";return["M",t.toFixed(2),e.toFixed(2),"L",r.x.toFixed(2),r.y.toFixed(2),"A",n.toFixed(2),n.toFixed(2),"0",a,s,l.x.toFixed(2),l.y.toFixed(2),"Z"].join(" ")},M=(...t)=>{false},N=n=>{const{config:i,id:o,useDataSources:r,useMapWidgetIds:l}=n,[a,s]=t.React.useState(null),[c,u]=t.React.useState([]),[d,f]=t.React.useState(null),[p,h]=t.React.useState(null),[m,g]=t.React.useState(!1),v=t.React.useRef(null),S=t.React.useRef([]),N=t.React.useRef(null),F=t.React.useRef(!1),E=t.React.useRef(!1),z=t.React.useRef(null),R=t.React.useMemo((()=>({page:1,pageSize:1e3})),[]),T=t.React.useCallback((t=>{var e;const n=null==l?void 0:l[0],i=null===(e=null==t?void 0:t.view)||void 0===e?void 0:e.container,o=null==i?void 0:i.parentElement,r=n?document.querySelector(`[data-widget-id="${n}"] .map-root`):null,a=n?document.querySelector(`[data-widget-id="${n}"] .esri-view-root`):null,s=n?document.querySelector(`[data-widget-id="${n}"] .esri-view`):null,c=n?document.querySelector(`[data-widget-id="${n}"]`):null,u=document.querySelector(".esri-view-root");return i||o||a||s||r||c||u||null}),[l]),I=t.React.useCallback((t=>{if(!t)return;t.querySelectorAll(".parking-lot-map-label").forEach((t=>{t.parentNode&&t.parentNode.removeChild(t)}))}),[]),j=t.React.useCallback((t=>{var e;if(!t)return null;if(null==t?void 0:t.feature)return t.feature;if("function"==typeof(null==t?void 0:t.getJSAPIGeometry)){const n=t.getJSAPIGeometry(),i=(null===(e=t.getData)||void 0===e?void 0:e.call(t))||{};if(n)return{geometry:n,attributes:i}}return(null==t?void 0:t.attributes)&&(null==t?void 0:t.geometry)?t:null}),[]),D=t.React.useCallback((t=>{var e;return t?"function"==typeof(null==t?void 0:t.getData)?t.getData()||null:(null===(e=null==t?void 0:t.feature)||void 0===e?void 0:e.attributes)?t.feature.attributes:(null==t?void 0:t.attributes)?t.attributes:null:null}),[]);t.React.useEffect((()=>{if(d||!(null==a?void 0:a.view))return;const t=T(a);t?(M((t.tagName,t.className)),f(t)):M()}),[a,d,T]),t.React.useEffect((()=>{if(!d)return;"static"===window.getComputedStyle(d).position&&(d.style.position="relative")}),[d]),t.React.useEffect((()=>{if(a&&c.length>0){const t=()=>{const t=a.view.zoom,e=Math.max(.3,Math.min(1,(t-10)/8));c.forEach((t=>{try{const n=a.view.toScreen(t.geometry);if(t.element){t.element.style.transform=`scale(${e})`,t.element.style.transformOrigin="20px bottom";const i=t.element.offsetHeight||60;t.element.style.left=n.x-20+"px",t.element.style.top=n.y-i-8+"px"}}catch(t){}}))},e=[a.view.watch("extent",t),a.view.watch("center",t),a.view.watch("zoom",t)];return t(),()=>{e.forEach((t=>{t&&"function"==typeof t.remove&&t.remove()}))}}}),[a,c]),t.React.useEffect((()=>()=>{c.forEach((t=>{t.element&&t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}),[c]),t.React.useEffect((()=>{I(d),u([]),h(null),g(!0),N.current=null,F.current=!1,E.current=!1,z.current=null}),[I,d,i.parkingLotField,i.utilizationField,i.showUtilizationText,i.allowNegatives,i.fullThreshold,i.availableColor,i.unavailableColor]),t.React.useEffect((()=>{if(!r||0===r.length)return h(null),g(!1),void(z.current=null);const t=r[0].dataSourceId;M(),null!==p&&t!==p&&(M(),I(d),u([]),N.current=null,F.current=!1,E.current=!1,z.current=null,g(!0)),p!==t&&(M(),h(t))}),[r,p,I,d]);const P=t.React.useCallback((t=>{null==t||t.reason;return g(!0),M(),!0}),[]),B=t.React.useCallback((t=>{var e;if(!d)return;const n=d.querySelectorAll(".parking-lot-map-label");if(0===n.length)return;const o=new Map;n.forEach((t=>{const e=t.getAttribute("data-parking-lot-id");e&&o.set(e,t)}));for(const n of t){const t=D(n);if(!t)continue;const r=null==t?void 0:t[i.parkingLotField],l=null==t?void 0:t[i.utilizationField];if(!r)continue;const a=String(r),s=o.get(a);if(!s)continue;const c=Number(l),u=Number.isFinite(c)?c:0,d=i.availableColor||"#E683DD",f=i.unavailableColor||"#8B8B8B",p=Math.max(0,Math.min(100,null!==(e=i.fullThreshold)&&void 0!==e?e:95));let h=100-u;!i.allowNegatives&&h<0&&(h=0);const m=u>=p||h<=Math.max(0,100-p)?"Full":`${Math.round(Math.max(0,Math.min(100,h)))}% Available`,g=i.showUtilizationText?m:"";let v=100-u;!i.allowNegatives&&v<0&&(v=0);const x=Math.max(0,Math.min(100,v));s.setAttribute("aria-label",`${r}: ${m}`);const b=Array.from(s.children),S=b[0],M=b[1];if(S){const t=S.querySelector("svg");if(t){const e=Math.max(0,Math.min(100,x)),n=-Math.min(e/100*360,359.999),i=Array.from(t.children),o=i[0];o&&"circle"===o.tagName&&o.setAttribute("fill",f);for(let e=i.length-2;e>=1;e--)t.removeChild(i[e]);if(e>0)if(e>=99.5){const e=document.createElementNS(y,"circle");e.setAttribute("cx",A.toFixed(2)),e.setAttribute("cy",A.toFixed(2)),e.setAttribute("r",(w-3).toFixed(2)),e.setAttribute("fill",d),e.setAttribute("stroke","none"),t.insertBefore(e,t.lastChild)}else{const e=document.createElementNS(y,"path");e.setAttribute("d",k(A,A,w-3,-90,n)),e.setAttribute("fill",d),e.setAttribute("stroke","none"),t.insertBefore(e,t.lastChild);const i=document.createElementNS(y,"path");i.setAttribute("d",C(A,A,w-3,-90,n)),i.setAttribute("fill","none"),i.setAttribute("stroke",d),i.setAttribute("stroke-width","3.5"),t.insertBefore(i,t.lastChild)}}}if(M){const t=Array.from(M.children);let e=i.showUtilizationText?0:-1,n=i.showUtilizationText?1:0;if(i.showUtilizationText&&e>=0&&t[e]){const n=t[e];n.textContent!==g&&(n.textContent=g)}if(t[n]){const e=t[n];e.textContent!==r&&(e.textContent=r)}}}}),[d,D,i.parkingLotField,i.utilizationField,i.availableColor,i.unavailableColor,i.allowNegatives,i.showUtilizationText,i.fullThreshold]);t.React.useEffect((()=>{var t,e;if(!(null===(t=null==a?void 0:a.view)||void 0===t?void 0:t.ready)||!p||!d)return;const n=v.current,i=null===(e=null==r?void 0:r[0])||void 0===e?void 0:e.dataSourceId;if(!n||"LOADED"!==n.getStatus()||!i||p!==i)return;if(F.current||E.current)return;0!==d.querySelectorAll(".parking-lot-map-label").length||m||P({reason:"bootstrap-no-labels"})}),[a,p,d,r,m,P]),t.React.useEffect((()=>{var t,e,n,i;if(!m)return void M();if(!(null===(t=null==a?void 0:a.view)||void 0===t?void 0:t.ready))return void M(null===(e=null==a?void 0:a.view)||void 0===e||e.ready);if(!p)return void M();if(!d)return void M();const o=v.current,l=null===(n=null==r?void 0:r[0])||void 0===n?void 0:n.dataSourceId;if(!o||!l||p!==l)return void M();const s=null===(i=o.getStatus)||void 0===i?void 0:i.call(o);if("LOADED"!==s)return void M();if(F.current||E.current)return void M((F.current,E.current));let c=!1;return F.current=!0,E.current=!0,b(void 0,void 0,void 0,(function*(){var t;try{const e=()=>b(void 0,void 0,void 0,(function*(){var t;const e=(null===(t=null==o?void 0:o.getRecords)||void 0===t?void 0:t.call(o))||[],n=e.slice(0,1e3),i=n.map((t=>j(t))).filter((t=>t));return M((e.length,n.length,i.length)),i})),n=yield e();if(M(n.length),c)return void M();if(0===n.length){const e=((null===(t=null==o?void 0:o.getRecords)||void 0===t?void 0:t.call(o))||[]).slice(0,1e3);return e.length>0?(B(e),M(e.length)):M(),void g(!1)}const i=d.querySelectorAll(".parking-lot-map-label").length;if(0===i){M(n.length),yield q(n);const t=d.querySelectorAll(".parking-lot-map-label").length;M(),t>0&&(N.current=l)}else M(n.length),yield $(n);g(!1)}catch(t){M(),g(!1)}finally{F.current=!1,E.current=!1}})),()=>{c=!0}}),[m,a,p,r,d,i.parkingLotField,i.utilizationField,i.showUtilizationText,i.allowNegatives,i.fullThreshold,i.availableColor,i.unavailableColor,j,B]);const G=t=>{var e;const n=Math.max(0,Math.min(100,null!==(e=i.fullThreshold)&&void 0!==e?e:95));let o=100-t;if(!i.allowNegatives&&o<0&&(o=0),t>=n||o<=Math.max(0,100-n))return"Full";const r=Math.max(0,Math.min(100,o));return`${Math.round(r)}% Available`},U=(t,e,n)=>{const i=Math.max(0,Math.min(100,t)),o=-Math.min(i/100*360,359.999),r=document.createElement("div");r.style.cssText="\n      width: 44px;\n      height: 44px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      flex-shrink: 0;\n      pointer-events: none;\n    ",r.setAttribute("aria-hidden","true");const l=document.createElementNS(y,"svg");l.setAttribute("width","44"),l.setAttribute("height","44"),l.setAttribute("viewBox","0 0 100 100"),l.style.display="block",l.style.flexShrink="0",l.style.pointerEvents="none",l.setAttribute("role","presentation"),l.setAttribute("focusable","false");const a=document.createElementNS(y,"circle");if(a.setAttribute("cx",A.toFixed(2)),a.setAttribute("cy",A.toFixed(2)),a.setAttribute("r",w.toFixed(2)),a.setAttribute("fill",n),a.setAttribute("stroke","none"),l.appendChild(a),i>0)if(i>=99.5){const t=document.createElementNS(y,"circle");t.setAttribute("cx",A.toFixed(2)),t.setAttribute("cy",A.toFixed(2)),t.setAttribute("r",(w-3).toFixed(2)),t.setAttribute("fill",e),t.setAttribute("stroke","none"),l.appendChild(t)}else{const t=document.createElementNS(y,"path");t.setAttribute("d",k(A,A,w-3,-90,o)),t.setAttribute("fill",e),t.setAttribute("stroke","none"),l.appendChild(t);const n=document.createElementNS(y,"path");n.setAttribute("d",C(A,A,w-3,-90,o)),n.setAttribute("fill","none"),n.setAttribute("stroke",e),n.setAttribute("stroke-width","3.5"),l.appendChild(n)}const s=document.createElementNS(y,"circle");return s.setAttribute("cx",A.toFixed(2)),s.setAttribute("cy",A.toFixed(2)),s.setAttribute("r",(w-1.5).toFixed(2)),s.setAttribute("fill","none"),s.setAttribute("stroke","#333333"),s.setAttribute("stroke-width","3"),l.appendChild(s),r.appendChild(l),r},q=e=>b(void 0,void 0,void 0,(function*(){var n,o,r,l,s,c,f;if(M(null==e||e.length),!d||!a)return void M();let p=null,h=null;try{const e=yield(0,t.loadArcGISJSAPIModules)(["esri/geometry/projection","esri/geometry/Point","esri/geometry/SpatialReference"]);p=e[0],h=e[1];e[2];yield p.load()}catch(t){}const m=new Set,g=[],v=new Map,x=d.querySelectorAll(".parking-lot-map-label");M(x.length),x.forEach((t=>{const e=t.getAttribute("data-parking-lot-id");e&&(v.set(e,t),M())})),M((v.size,Array.from(v.keys())));let b={};e.length>0&&M((e[0],Object.keys(e[0]||{}),null===(n=e[0])||void 0===n||n.getData,null===(o=e[0])||void 0===o||o.getJSAPIGeometry,null===(r=e[0])||void 0===r||r.getGeometry,null===(l=e[0])||void 0===l||l.attributes,null===(s=e[0])||void 0===s||s.geometry,null===(f=null===(c=e[0])||void 0===c?void 0:c.constructor)||void 0===f||f.name));for(const t of e){let e,n=null;if("function"==typeof t.getData){e=t.getData();try{if("function"==typeof t.getJSAPIGeometry)n=t.getJSAPIGeometry();else if("function"==typeof t.getGeometry){const e=t.getGeometry();e&&(n=e)}}catch(t){M()}}else t.attributes&&t.geometry?(e=t.attributes,n=t.geometry):(M(Object.keys(t||{})),e=t.data||t.attributes||t,n=t.geometry||t.geom||null);const o=null==e?void 0:e[i.parkingLotField],r=null==e?void 0:e[i.utilizationField];if(!n){b.noGeometry=(b.noGeometry||0)+1,M((t.getData,t.getJSAPIGeometry,t.getGeometry,t.geometry,t.attributes,Object.keys(t||{})));continue}if(!o){b.noName=(b.noName||0)+1,M();continue}M();const l=Number(r),s=Number.isFinite(l)?l:0,c=i.availableColor||"#E683DD",u=i.unavailableColor||"#8B8B8B",f=G(s),h=i.showUtilizationText?f:"";let x=100-s;!i.allowNegatives&&x<0&&(x=0);const S=Math.max(0,Math.min(100,x)),N=String(o);m.add(N);try{const t=a.view.spatialReference,e=n.spatialReference;if(p&&e&&t&&e.wkid!==t.wkid){const e=p.project(n,t);e&&(n=e)}}catch(t){}let F;try{F=a.view.toScreen(n)}catch(t){b.coordError=(b.coordError||0)+1,M();continue}let E=v.get(N);const z=!E;if(M(v.size),E){M();const t=F.x-50+"px",r=F.y-30+"px";E.style.left!==t&&(E.style.left=t),E.style.top!==r&&(E.style.top=r),E.setAttribute("aria-label",`${o}: ${f}`);const l=Array.from(E.children),a=l[0],s=l[1];if(a){const t=a.querySelector("svg");if(t){const e=Math.max(0,Math.min(100,S)),n=-Math.min(e/100*360,359.999),i=Array.from(t.children),o=i[0];o&&"circle"===o.tagName&&o.setAttribute("fill",u);for(let e=i.length-2;e>=1;e--)t.removeChild(i[e]);if(e>0)if(e>=99.5){const e=document.createElementNS(y,"circle");e.setAttribute("cx",A.toFixed(2)),e.setAttribute("cy",A.toFixed(2)),e.setAttribute("r",(w-3).toFixed(2)),e.setAttribute("fill",c),e.setAttribute("stroke","none"),t.insertBefore(e,t.lastChild)}else{const e=document.createElementNS(y,"path");e.setAttribute("d",k(A,A,w-3,-90,n)),e.setAttribute("fill",c),e.setAttribute("stroke","none"),t.insertBefore(e,t.lastChild);const i=document.createElementNS(y,"path");i.setAttribute("d",C(A,A,w-3,-90,n)),i.setAttribute("fill","none"),i.setAttribute("stroke",c),i.setAttribute("stroke-width","3.5"),t.insertBefore(i,t.lastChild)}}}if(s){const t=Array.from(s.children);let e=i.showUtilizationText?0:-1,n=i.showUtilizationText?1:0;if(i.showUtilizationText&&e>=0&&t[e]){const n=t[e];n.textContent!==h&&(n.textContent=h)}if(t[n]){const e=t[n];e.textContent!==o&&(e.textContent=o)}}g.push({element:E,geometry:n,data:e});continue}E=document.createElement("div"),E.className="parking-lot-map-label",E.setAttribute("role","img"),E.setAttribute("aria-label",`${o}: ${f}`),E.setAttribute("tabindex","-1"),E.setAttribute("data-parking-lot-id",N),E.style.cssText=`\n        position: absolute;\n        left: ${F.x-50}px;\n        top: ${F.y-30}px;\n        background: white;\n        border-radius: 12px;\n        padding: 8px 8px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.15);\n        border: 1px solid #d0d0d0;\n        font-family: 'Avenir Next', 'Helvetica Neue', Arial, sans-serif;\n        z-index: 1000;\n        pointer-events: none;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        min-width: 150px;\n      `;const R=document.createElement("div");R.style.cssText="\n        position: absolute;\n        bottom: -8px;\n        left: 20px;\n        width: 0;\n        height: 0;\n        border-left: 8px solid transparent;\n        border-right: 8px solid transparent;\n        border-top: 8px solid white;\n        z-index: 1001;\n      ";const T=document.createElement("div");T.style.cssText="\n        position: absolute;\n        bottom: -9px;\n        left: 20px;\n        width: 0;\n        height: 0;\n        border-left: 9px solid transparent;\n        border-right: 9px solid transparent;\n        border-top: 9px solid #d0d0d0;\n        z-index: 1000;\n      ";const I=U(S,c,u),j=document.createElement("div");if(j.style.cssText="\n        display: flex;\n        flex-direction: column;\n        gap: 1px;\n      ",i.showUtilizationText){const t=document.createElement("div");t.textContent=h,t.style.cssText="\n          font-size: 16px;\n          color: #000000;\n          line-height: 1.2;\n          font-weight: 900;\n        ",j.appendChild(t)}const D=document.createElement("div");D.textContent=o,D.style.cssText="\n        font-size: 13px;\n        font-weight: 700;\n        color: #000000;\n        line-height: 1.2;\n      ",j.appendChild(D),E.appendChild(I),E.appendChild(j),E.appendChild(T),E.appendChild(R);E.childNodes.length;if(M(),z)try{d.appendChild(E),M()}catch(t){M();continue}else M((E.childNodes.length,j.textContent));g.push({element:E,geometry:n,data:e})}v.forEach(((t,e)=>{m.has(e)||(M(),t.parentNode&&t.parentNode.removeChild(t))}));d.querySelectorAll(".parking-lot-map-label").length;M((g.length,g.filter((t=>!v.has(t.element.getAttribute("data-parking-lot-id")||""))).length,g.filter((t=>v.has(t.element.getAttribute("data-parking-lot-id")||""))).length,d&&d.tagName,e.length)),S.current=g,u(g)})),$=t=>b(void 0,void 0,void 0,(function*(){if(M(null==t||t.length),!d||!a)return void M();const e=d.querySelectorAll(".parking-lot-map-label"),n=new Map,o=new Set;e.forEach((t=>{const e=t.getAttribute("data-parking-lot-id");e&&n.set(e,t)})),M((n.size,t.length));for(const e of t){let t,r=null;if("function"==typeof e.getData){t=e.getData();try{if("function"==typeof e.getJSAPIGeometry)r=e.getJSAPIGeometry();else if("function"==typeof e.getGeometry){const t=e.getGeometry();t&&(r=t)}}catch(t){continue}}else e.attributes&&e.geometry?(t=e.attributes,r=e.geometry):(t=e.data||e.attributes||e,r=e.geometry||e.geom||null);const l=null==t?void 0:t[i.parkingLotField],s=null==t?void 0:t[i.utilizationField];if(!r||!l)continue;const c=String(l);o.add(c);const u=n.get(c);if(!u)continue;const d=Number(s),f=Number.isFinite(d)?d:0,p=i.availableColor||"#E683DD",h=i.unavailableColor||"#8B8B8B",m=G(f),g=i.showUtilizationText?m:"";let v=100-f;!i.allowNegatives&&v<0&&(v=0);const x=Math.max(0,Math.min(100,v));try{const t=a.view.toScreen(r),e=t.x-50+"px",n=t.y-30+"px";u.style.left!==e&&(u.style.left=e),u.style.top!==n&&(u.style.top=n)}catch(t){}u.setAttribute("aria-label",`${l}: ${m}`);const b=Array.from(u.children),S=b[0],M=b[1];if(S){const t=S.querySelector("svg");if(t){const e=Math.max(0,Math.min(100,x)),n=Math.min(e/100*360,359.999),i=Array.from(t.children),o=i[0];o&&"circle"===o.tagName&&o.setAttribute("fill",h);for(let e=i.length-2;e>=1;e--)t.removeChild(i[e]);if(e>0)if(e>=99.5){const e=document.createElementNS(y,"circle");e.setAttribute("cx",A.toFixed(2)),e.setAttribute("cy",A.toFixed(2)),e.setAttribute("r",(w-3).toFixed(2)),e.setAttribute("fill",p),e.setAttribute("stroke","none"),t.insertBefore(e,t.lastChild)}else{const e=document.createElementNS(y,"path");e.setAttribute("d",k(A,A,w-3,-90,n)),e.setAttribute("fill",p),e.setAttribute("stroke","none"),t.insertBefore(e,t.lastChild);const i=document.createElementNS(y,"path");i.setAttribute("d",C(A,A,w-3,-90,n)),i.setAttribute("fill","none"),i.setAttribute("stroke",p),i.setAttribute("stroke-width","3.5"),t.insertBefore(i,t.lastChild)}}}if(M){const t=Array.from(M.children);let e=i.showUtilizationText?0:-1,n=i.showUtilizationText?1:0;if(i.showUtilizationText&&e>=0&&t[e]){const n=t[e];n.textContent!==g&&(n.textContent=g)}if(t[n]){const e=t[n];e.textContent!==l&&(e.textContent=l)}}}n.forEach(((t,e)=>{o.has(e)||(M(),t.parentNode&&t.parentNode.removeChild(t))})),M((o.size,n.size,o.size))}));return(0,t.jsx)("div",{className:"parking-lot-widget jimu-widget","data-widget-id":o,style:{width:"100%",height:"100%",overflow:"hidden",position:"relative"}},l&&l.length>0&&(0,t.jsx)(e.JimuMapViewComponent,{useMapWidgetId:l[0],onActiveViewChange:t=>{if(t){s(t);const e=T(t);e?(M((e.tagName,e.className)),f(e)):M()}}}),r&&r.length>0?(0,t.jsx)(t.DataSourceComponent,{useDataSource:r[0],widgetId:o,query:R,onDataSourceInfoChange:(t,e)=>{if(t&&void 0!==t.sourceVersion){const n=e&&t.sourceVersion!==e.sourceVersion,i=z.current!==t.sourceVersion;(n||null===z.current)&&i&&(z.current=t.sourceVersion,P({reason:"source-version-changed"}))}}},(t=>{var e,n,i,o;if(M((null===(e=null==t?void 0:t.getStatus)||void 0===e||e.call(t),null===(n=null==r?void 0:r[0])||void 0===n||n.dataSourceId)),!t)return v.current=null,M(),null;v.current=t;null===(i=t.getStatus)||void 0===i||i.call(t),null===(o=null==r?void 0:r[0])||void 0===o||o.dataSourceId;return M(),M((t.id,t.type,t.getStatus())),null})):null,l&&0!==l.length?r&&0!==r.length?null:(0,t.jsx)("div",{className:"no-data"},(0,t.jsx)(t.FormattedMessage,{id:"configureDataSource",defaultMessage:x})):(0,t.jsx)("div",{className:"no-data"},(0,t.jsx)(t.FormattedMessage,{id:"selectMap",defaultMessage:"Please select a map widget in the settings"})))};function F(t){o.p=t}})(),r})())}}}));