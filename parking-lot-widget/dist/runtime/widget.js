System.register(["jimu-core","jimu-arcgis"],(function(e,t){var n={},o={};return{setters:[function(e){n.DataSourceComponent=e.DataSourceComponent,n.DataSourceManager=e.DataSourceManager,n.FormattedMessage=e.FormattedMessage,n.React=e.React,n.jsx=e.jsx,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent}],execute:function(){e((()=>{var e={56:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{"use strict";var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var i={},a=[],s=0;s<e.length;s++){var l=e[s],c=o.base?l[0]+o.base:l[0],d=i[c]||0,u="".concat(c," ").concat(d);i[c]=d+1;var p=n(u),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)t[p].references++,t[p].updater(f);else{var m=r(f,o);o.byIndex=s,t.splice(s,0,{identifier:u,updater:m,references:1})}a.push(u)}return a}function r(e,t){var n=t.domAPI(t);n.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var i=o(e=e||[],r=r||{});return function(e){e=e||[];for(var a=0;a<i.length;a++){var s=n(i[a]);t[s].references--}for(var l=o(e,r),c=0;c<i.length;c++){var d=n(i[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}i=l}}},113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},244:e=>{"use strict";e.exports=n},314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,o,r,i){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(o)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(a[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);o&&a[d[0]]||(void 0!==i&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=i),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),r&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=r):d[4]="".concat(r)),t.push(d))}},t}},400:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var o=n(601),r=n.n(o),i=n(314),a=n.n(i)()(r());a.push([e.id,'.parking-lot-widget{padding:16px;font-family:"Avenir Next","Helvetica Neue",Arial,sans-serif}.widget-header{margin-bottom:16px}.widget-header h3{margin:0;font-size:18px;font-weight:600;color:#323232}.widget-content{min-height:100px}.parking-lot-list{display:flex;flex-direction:column;gap:12px}.parking-lot-item{background:white;border-radius:8px;padding:10px 12px;box-shadow:0 2px 8px rgba(0, 0, 0, 0.1);border:1px solid #e0e0e0}.parking-lot-content{display:flex;align-items:center;gap:12px;margin-bottom:2px}.utilization-dot{width:20px;height:20px;border-radius:50%;flex-shrink:0;border:2px solid white;box-shadow:0 1px 3px rgba(0, 0, 0, 0.2)}.parking-lot-name{font-size:16px;font-weight:700;color:#323232;line-height:1.3;display:flex;align-items:center}.utilization-text{font-size:14px;color:#666;font-weight:400;margin-left:32px}.no-data{text-align:center;color:#999;font-style:italic;padding:20px;background:#f8f8f8;border-radius:8px;border:1px dashed #ccc}.loading{text-align:center;color:#666;padding:20px;background:#f8f8f8;border-radius:8px;border:1px solid #e0e0e0}@media(max-width: 480px){.parking-lot-widget{padding:12px}.parking-lot-item{padding:10px}.parking-lot-name{font-size:14px}.utilization-text{font-size:12px}}.parking-lot-item:hover{box-shadow:0 4px 12px rgba(0, 0, 0, 0.15);transform:translateY(-1px);transition:all .2s ease}.parking-lot-widget.loading{opacity:.6;pointer-events:none}.parking-lot-widget.loading::after{content:"";position:absolute;top:50%;left:50%;width:20px;height:20px;margin:-10px 0 0 -10px;border:2px solid #f3f3f3;border-top:2px solid #3498db;border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}',""]);const s=a},540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{"use strict";e.exports=function(e){return e[1]}},659:e=>{"use strict";var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},686:e=>{"use strict";e.exports=o},825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,r&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function r(n){var o=t[n];if(void 0!==o)return o.exports;var i=t[n]={id:n,exports:{}};return e[n](i,i.exports,r),i.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="",r.nc=void 0;var i={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(i),r.d(i,{__set_webpack_public_path__:()=>b,default:()=>w});var e=r(244),t=r(686),n=r(72),o=r.n(n),a=r(825),s=r.n(a),l=r(659),c=r.n(l),d=r(56),u=r.n(d),p=r(540),f=r.n(p),m=r(113),g=r.n(m),x=r(400),h={};h.styleTagTransform=g(),h.setAttributes=u(),h.insert=c().bind(null,"head"),h.domAPI=s(),h.insertStyleElement=f();o()(x.A,h);x.A&&x.A.locals&&x.A.locals;const v="Please configure a data source in the widget settings";var y=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};const w=n=>{const{config:o,id:r,useDataSources:i,useMapWidgetIds:a}=n,[s,l]=e.React.useState(null),[c,d]=e.React.useState([]),[u,p]=e.React.useState(null),[f,m]=e.React.useState(!1),[g,x]=e.React.useState(0),h=e.React.useRef([]);e.React.useEffect((()=>{if(s&&c.length>0){const e=()=>{const e=s.view.zoom;x(e);const t=Math.max(.3,Math.min(1,(e-10)/8));c.forEach((e=>{try{const n=s.view.toScreen(e.geometry);if(e.element){e.element.style.transform=`scale(${t})`,e.element.style.transformOrigin="20px bottom";const o=e.element.offsetHeight||60;e.element.style.left=n.x-20+"px",e.element.style.top=n.y-o-8+"px"}}catch(e){}}))};s.view.watch("extent",e),s.view.watch("center",e),s.view.watch("zoom",e),e()}}),[s,c]),e.React.useEffect((()=>()=>{c.forEach((e=>{e.element&&e.element.parentNode&&e.element.parentNode.removeChild(e.element)}))}),[c]),e.React.useEffect((()=>{document.querySelectorAll(".parking-lot-map-label").forEach((e=>{e.parentNode&&e.parentNode.removeChild(e)})),d([]),m(!1)}),[i,o.parkingLotField,o.utilizationField,o.showUtilizationText,o.allowNegatives,o.colorRanges,o.fullThreshold]);const w=e=>{let t=e;!o.allowNegatives&&e<0&&(t=0);const n=o.colorRanges.find((e=>t>=e.minValue&&t<=e.maxValue));return n?n.color:"#666666"},b=e=>{if(e>=o.fullThreshold)return"Full";let t=100-e;return!o.allowNegatives&&t<0&&(t=0),`${Math.round(t)}% available`};return(0,e.jsx)("div",{className:"parking-lot-widget jimu-widget","data-widget-id":r,style:{width:"100%",height:"100%",overflow:"hidden"}},a&&a.length>0&&(0,e.jsx)(t.JimuMapViewComponent,{useMapWidgetId:a[0],onActiveViewChange:e=>{if(e){l(e);let t=document.querySelector(`[data-widget-id="${null==a?void 0:a[0]}"] .map-root`);if(t||(t=document.querySelector(`[data-widget-id="${null==a?void 0:a[0]}"] .esri-view`),t||(t=document.querySelector(`[data-widget-id="${null==a?void 0:a[0]}"] .esri-view-root`)),t||(t=document.querySelector(`[data-widget-id="${null==a?void 0:a[0]}"]`))),t)p(t);else{const e=document.querySelector(".esri-view-root");e&&p(e)}}}}),i&&i.length>0&&u?(0,e.jsx)(e.DataSourceComponent,{useDataSource:i[0],widgetId:r,query:{page:1,pageSize:1e3}},(t=>{if(!t)return null;if("LOADED"===t.getStatus()&&!f){const t=e.DataSourceManager.getInstance().getDataSource(i[0].dataSourceId);if(t&&"FEATURE_LAYER"===t.type){const n=t.layer;if(n){const t=()=>{var r;(null===(r=null==s?void 0:s.view)||void 0===r?void 0:r.ready)?n.queryFeatures({where:"1=1",outFields:["*"],returnGeometry:!0}).then((t=>{t.features&&t.features.length>0&&setTimeout((()=>{var n;n=t.features,y(void 0,void 0,void 0,(function*(){if(!u||!s)return;let t=null,r=null;try{const n=yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/projection","esri/geometry/Point","esri/geometry/SpatialReference"]);t=n[0],r=n[1],n[2],yield t.load()}catch(e){}h.current.forEach((e=>{e.element&&e.element.parentNode&&e.element.parentNode.removeChild(e.element)})),document.querySelectorAll(".parking-lot-map-label").forEach((e=>{e.parentNode&&e.parentNode.removeChild(e)})),h.current=[],d([]);const i=[];for(const e of n){const n=e.attributes,r=n[o.parkingLotField],a=n[o.utilizationField];let l=e.geometry;if(!l||!r)continue;const c=w(Number(a)||0),d=o.showUtilizationText?b(Number(a)||0):"";try{const e=s.view.spatialReference,n=l.spatialReference;if(t&&n&&e&&n.wkid!==e.wkid){const n=t.project(l,e);n&&(l=n)}}catch(e){}let p;try{p=s.view.toScreen(l)}catch(e){continue}const f=document.createElement("div");f.className="parking-lot-map-label",f.style.cssText=`\n        position: absolute;\n        left: ${p.x-50}px;\n        top: ${p.y-30}px;\n        background: white;\n        border-radius: 12px;\n        padding: 10px 14px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.15);\n        border: 1px solid #d0d0d0;\n        font-family: 'Avenir Next', 'Helvetica Neue', Arial, sans-serif;\n        z-index: 1000;\n        pointer-events: none;\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        min-width: 120px;\n      `;const m=document.createElement("div");m.style.cssText="\n        position: absolute;\n        bottom: -8px;\n        left: 20px;\n        width: 0;\n        height: 0;\n        border-left: 8px solid transparent;\n        border-right: 8px solid transparent;\n        border-top: 8px solid white;\n        z-index: 1001;\n      ";const g=document.createElement("div");g.style.cssText="\n        position: absolute;\n        bottom: -9px;\n        left: 20px;\n        width: 0;\n        height: 0;\n        border-left: 9px solid transparent;\n        border-right: 9px solid transparent;\n        border-top: 9px solid #d0d0d0;\n        z-index: 1000;\n      ";const x=document.createElement("div");x.style.cssText=`\n        width: 32px;\n        height: 32px;\n        border-radius: 50%;\n        background-color: ${c};\n        flex-shrink: 0;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        color: white;\n        font-weight: bold;\n        font-size: 18px;\n        font-family: 'Avenir Next', 'Helvetica Neue', Arial, sans-serif;\n      `,x.textContent="P";const h=document.createElement("div");h.style.cssText="\n        display: flex;\n        flex-direction: column;\n        gap: 1px;\n      ";const v=document.createElement("div");if(v.textContent=r,v.style.cssText="\n        font-size: 16px;\n        font-weight: bold;\n        color: #323232;\n        line-height: 1.2;\n        margin-bottom: 1px;\n      ",h.appendChild(v),o.showUtilizationText){const e=document.createElement("div");e.textContent=d,e.style.cssText="\n          font-size: 13px;\n          color: #666666;\n          line-height: 1.2;\n          font-weight: normal;\n        ",h.appendChild(e)}f.appendChild(x),f.appendChild(h),f.appendChild(g),f.appendChild(m),u.appendChild(f),i.push({element:f,geometry:l,data:n})}h.current=i,d(i)})),m(!0)}),500)})).catch((e=>{var n;(null===(n=e.message)||void 0===n?void 0:n.includes("projection"))&&setTimeout((()=>{t()}),1e3)})):setTimeout(t,100)};t()}}}return null})):null,a&&0!==a.length?i&&0!==i.length?null:(0,e.jsx)("div",{className:"no-data"},(0,e.jsx)(e.FormattedMessage,{id:"configureDataSource",defaultMessage:v})):(0,e.jsx)("div",{className:"no-data"},(0,e.jsx)(e.FormattedMessage,{id:"selectMap",defaultMessage:"Please select a map widget in the settings"})))};function b(e){r.p=e}})(),i})())}}}));