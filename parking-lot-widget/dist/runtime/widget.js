System.register(["jimu-core","jimu-arcgis"],(function(e,t){var n={},o={};return{setters:[function(e){n.DataSourceComponent=e.DataSourceComponent,n.FormattedMessage=e.FormattedMessage,n.React=e.React,n.jsx=e.jsx,n.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent}],execute:function(){e((()=>{var e={56:(e,t,n)=>{"use strict";e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{"use strict";var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var r={},a=[],s=0;s<e.length;s++){var l=e[s],d=o.base?l[0]+o.base:l[0],c=r[d]||0,u="".concat(d," ").concat(c);r[d]=c+1;var p=n(u),f={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)t[p].references++,t[p].updater(f);else{var m=i(f,o);o.byIndex=s,t.splice(s,0,{identifier:u,updater:m,references:1})}a.push(u)}return a}function i(e,t){var n=t.domAPI(t);n.update(e);return function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var r=o(e=e||[],i=i||{});return function(e){e=e||[];for(var a=0;a<r.length;a++){var s=n(r[a]);t[s].references--}for(var l=o(e,i),d=0;d<r.length;d++){var c=n(r[d]);0===t[c].references&&(t[c].updater(),t.splice(c,1))}r=l}}},113:e=>{"use strict";e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},244:e=>{"use strict";e.exports=n},314:e=>{"use strict";e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,o,i,r){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(o)for(var s=0;s<this.length;s++){var l=this[s][0];null!=l&&(a[l]=!0)}for(var d=0;d<e.length;d++){var c=[].concat(e[d]);o&&a[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=r),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),i&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=i):c[4]="".concat(i)),t.push(c))}},t}},400:(e,t,n)=>{"use strict";n.d(t,{A:()=>s});var o=n(601),i=n.n(o),r=n(314),a=n.n(r)()(i());a.push([e.id,'.parking-lot-widget{padding:16px;font-family:"Avenir Next","Helvetica Neue",Arial,sans-serif}.widget-header{margin-bottom:16px}.widget-header h3{margin:0;font-size:18px;font-weight:600;color:#323232}.widget-content{min-height:100px}.parking-lot-list{display:flex;flex-direction:column;gap:12px}.parking-lot-item{background:white;border-radius:8px;padding:10px 12px;box-shadow:0 2px 8px rgba(0, 0, 0, 0.1);border:1px solid #e0e0e0}.parking-lot-content{display:flex;align-items:center;gap:12px;margin-bottom:2px}.utilization-dot{width:20px;height:20px;border-radius:50%;flex-shrink:0;border:2px solid white;box-shadow:0 1px 3px rgba(0, 0, 0, 0.2)}.parking-lot-name{font-size:16px;font-weight:700;color:#323232;line-height:1.3;display:flex;align-items:center}.utilization-text{font-size:14px;color:#666;font-weight:400;margin-left:32px}.no-data{text-align:center;color:#999;font-style:italic;padding:20px;background:#f8f8f8;border-radius:8px;border:1px dashed #ccc}.loading{text-align:center;color:#666;padding:20px;background:#f8f8f8;border-radius:8px;border:1px solid #e0e0e0}@media(max-width: 480px){.parking-lot-widget{padding:12px}.parking-lot-item{padding:10px}.parking-lot-name{font-size:14px}.utilization-text{font-size:12px}}.parking-lot-item:hover{box-shadow:0 4px 12px rgba(0, 0, 0, 0.15);transform:translateY(-1px);transition:all .2s ease}.parking-lot-widget.loading{opacity:.6;pointer-events:none}.parking-lot-widget.loading::after{content:"";position:absolute;top:50%;left:50%;width:20px;height:20px;margin:-10px 0 0 -10px;border:2px solid #f3f3f3;border-top:2px solid #3498db;border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}',""]);const s=a},540:e=>{"use strict";e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},601:e=>{"use strict";e.exports=function(e){return e[1]}},659:e=>{"use strict";var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},686:e=>{"use strict";e.exports=o},825:e=>{"use strict";e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,i&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function i(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={id:n,exports:{}};return e[n](r,r.exports,i),r.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="",i.nc=void 0;var r={};return i.p=window.jimuConfig.baseUrl,(()=>{"use strict";i.r(r),i.d(r,{__set_webpack_public_path__:()=>k,default:()=>M});var e=i(244),t=i(686),n=i(72),o=i.n(n),a=i(825),s=i.n(a),l=i(659),d=i.n(l),c=i(56),u=i.n(c),p=i(540),f=i.n(p),m=i(113),x=i.n(m),h=i(400),g={};g.styleTagTransform=x(),g.setAttributes=u(),g.insert=d().bind(null,"head"),g.domAPI=s(),g.insertStyleElement=f();o()(h.A,g);h.A&&h.A.locals&&h.A.locals;const v="Please configure a data source in the widget settings";var b=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function a(e){try{l(o.next(e))}catch(e){r(e)}}function s(e){try{l(o.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};const y="http://www.w3.org/2000/svg",w=50,A=46,S=(e,t,n,o)=>{const i=Math.PI/180*o;return{x:e+n*Math.cos(i),y:t+n*Math.sin(i)}},M=n=>{const{config:o,id:i,useDataSources:r,useMapWidgetIds:a}=n,[s,l]=e.React.useState(null),[d,c]=e.React.useState([]),[u,p]=e.React.useState(null),[f,m]=e.React.useState(null),x=e.React.useRef([]);e.React.useEffect((()=>{if(s&&d.length>0){const e=()=>{const e=s.view.zoom,t=Math.max(.3,Math.min(1,(e-10)/8));d.forEach((e=>{try{const n=s.view.toScreen(e.geometry);if(e.element){e.element.style.transform=`scale(${t})`,e.element.style.transformOrigin="20px bottom";const o=e.element.offsetHeight||60;e.element.style.left=n.x-20+"px",e.element.style.top=n.y-o-8+"px"}}catch(e){}}))},t=[s.view.watch("extent",e),s.view.watch("center",e),s.view.watch("zoom",e)];return e(),()=>{t.forEach((e=>{e&&"function"==typeof e.remove&&e.remove()}))}}}),[s,d]),e.React.useEffect((()=>()=>{d.forEach((e=>{e.element&&e.element.parentNode&&e.element.parentNode.removeChild(e.element)}))}),[d]),e.React.useEffect((()=>{document.querySelectorAll(".parking-lot-map-label").forEach((e=>{e.parentNode&&e.parentNode.removeChild(e)})),c([]),m(null)}),[o.parkingLotField,o.utilizationField,o.showUtilizationText,o.allowNegatives,o.fullThreshold]),e.React.useEffect((()=>{if(!r||0===r.length)return void m(null);const e=r[0].dataSourceId;if(null!==f&&e!==f){document.querySelectorAll(".parking-lot-map-label").forEach((e=>{e.parentNode&&e.parentNode.removeChild(e)})),c([])}m(e)}),[r,f]);const h=e=>{var t;const n=Math.max(0,Math.min(100,null!==(t=o.fullThreshold)&&void 0!==t?t:95));let i=100-e;if(!o.allowNegatives&&i<0&&(i=0),e>=n||i<=Math.max(0,100-n))return"Full";const r=Math.max(0,Math.min(100,i));return`${Math.round(r)}% Available`},g=(e,t)=>{const n=100-Math.max(0,Math.min(100,e)),o=Math.min(n/100*360,359.999),i=document.createElement("div");i.style.cssText="\n      width: 44px;\n      height: 44px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      flex-shrink: 0;\n      pointer-events: none;\n    ",i.setAttribute("aria-hidden","true");const r=document.createElementNS(y,"svg");r.setAttribute("width","44"),r.setAttribute("height","44"),r.setAttribute("viewBox","0 0 100 100"),r.style.display="block",r.style.flexShrink="0",r.style.pointerEvents="none",r.setAttribute("role","presentation"),r.setAttribute("focusable","false");const a=document.createElementNS(y,"circle");if(a.setAttribute("cx",w.toFixed(2)),a.setAttribute("cy",w.toFixed(2)),a.setAttribute("r",A.toFixed(2)),a.setAttribute("fill","rgba(224,224,224,0.25)"),a.setAttribute("stroke","none"),r.appendChild(a),n>0)if(n>=99.5){const e=document.createElementNS(y,"circle");e.setAttribute("cx",w.toFixed(2)),e.setAttribute("cy",w.toFixed(2)),e.setAttribute("r",(A-3).toFixed(2)),e.setAttribute("fill",t),e.setAttribute("stroke","none"),r.appendChild(e)}else{const e=document.createElementNS(y,"path");e.setAttribute("d",((e,t,n,o,i)=>{const r=S(e,t,n,o),a=S(e,t,n,o+i),s=i>180?"1":"0";return["M",e.toFixed(2),t.toFixed(2),"L",r.x.toFixed(2),r.y.toFixed(2),"A",n.toFixed(2),n.toFixed(2),"0",s,"1",a.x.toFixed(2),a.y.toFixed(2),"Z"].join(" ")})(w,w,A-3,-90,o)),e.setAttribute("fill",t),e.setAttribute("stroke","none"),r.appendChild(e);const n=document.createElementNS(y,"path");n.setAttribute("d",((e,t,n,o,i)=>{const r=o+i,a=S(e,t,n,o),s=S(e,t,n,r),l=i>180?"1":"0";return["M",a.x.toFixed(2),a.y.toFixed(2),"A",n.toFixed(2),n.toFixed(2),"0",l,"1",s.x.toFixed(2),s.y.toFixed(2)].join(" ")})(w,w,A-3,-90,o)),n.setAttribute("fill","none"),n.setAttribute("stroke",t),n.setAttribute("stroke-width","3.5"),r.appendChild(n)}const s=document.createElementNS(y,"circle");return s.setAttribute("cx",w.toFixed(2)),s.setAttribute("cy",w.toFixed(2)),s.setAttribute("r",(A-1.5).toFixed(2)),s.setAttribute("fill","none"),s.setAttribute("stroke","#333333"),s.setAttribute("stroke-width","3"),r.appendChild(s),i.appendChild(r),i};return(0,e.jsx)("div",{className:"parking-lot-widget jimu-widget","data-widget-id":i,style:{width:"100%",height:"100%",overflow:"hidden",position:"relative"}},a&&a.length>0&&(0,e.jsx)(t.JimuMapViewComponent,{useMapWidgetId:a[0],onActiveViewChange:e=>{if(e){l(e);let t=document.querySelector(`[data-widget-id="${null==a?void 0:a[0]}"] .map-root`);if(t||(t=document.querySelector(`[data-widget-id="${null==a?void 0:a[0]}"] .esri-view`),t||(t=document.querySelector(`[data-widget-id="${null==a?void 0:a[0]}"] .esri-view-root`)),t||(t=document.querySelector(`[data-widget-id="${null==a?void 0:a[0]}"]`))),t)p(t);else{const e=document.querySelector(".esri-view-root");e&&p(e)}}}}),r&&r.length>0&&u?(0,e.jsx)(e.DataSourceComponent,{useDataSource:r[0],widgetId:i,query:{where:"1=1",outFields:["*"],returnGeometry:!0,pageSize:1e3},onDataSourceInfoChange:e=>{if(e&&void 0!==e.sourceVersion){document.querySelectorAll(".parking-lot-map-label").forEach((e=>{e.parentNode&&e.parentNode.removeChild(e)})),c([])}}},(t=>{var n;if(!t)return null;if("LOADED"===t.getStatus()){const i=r[0].dataSourceId;if(0===d.length&&f===i&&(null===(n=null==s?void 0:s.view)||void 0===n?void 0:n.ready)){const n=t.getRecords();if(n&&n.length>0){const t=n.map((e=>e.feature)).filter((e=>e));t.length>0&&setTimeout((()=>{(t=>{b(void 0,void 0,void 0,(function*(){if(!u||!s)return;let n=null,i=null;try{const t=yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/projection","esri/geometry/Point","esri/geometry/SpatialReference"]);n=t[0],i=t[1],t[2],yield n.load()}catch(e){}x.current.forEach((e=>{e.element&&e.element.parentNode&&e.element.parentNode.removeChild(e.element)})),document.querySelectorAll(".parking-lot-map-label").forEach((e=>{e.parentNode&&e.parentNode.removeChild(e)})),x.current=[],c([]);const r=[];for(const e of t){const t=e.attributes,i=t[o.parkingLotField],a=t[o.utilizationField];let l=e.geometry;if(!l||!i)continue;const d=Number(a),c=Number.isFinite(d)?d:0,p="#F44336",f=h(c),m=o.showUtilizationText?f:"";let x=100-c;!o.allowNegatives&&x<0&&(x=0);const v=Math.max(0,Math.min(100,x));try{const e=s.view.spatialReference,t=l.spatialReference;if(n&&t&&e&&t.wkid!==e.wkid){const t=n.project(l,e);t&&(l=t)}}catch(e){}let b;try{b=s.view.toScreen(l)}catch(e){continue}const y=document.createElement("div");y.className="parking-lot-map-label",y.style.cssText=`\n        position: absolute;\n        left: ${b.x-50}px;\n        top: ${b.y-30}px;\n        background: white;\n        border-radius: 12px;\n        padding: 8px 8px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.15);\n        border: 1px solid #d0d0d0;\n        font-family: 'Avenir Next', 'Helvetica Neue', Arial, sans-serif;\n        z-index: 1000;\n        pointer-events: none;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        min-width: 150px;\n      `,y.setAttribute("role","img"),y.setAttribute("aria-label",`${i}: ${f}`),y.setAttribute("tabindex","-1");const w=document.createElement("div");w.style.cssText="\n        position: absolute;\n        bottom: -8px;\n        left: 20px;\n        width: 0;\n        height: 0;\n        border-left: 8px solid transparent;\n        border-right: 8px solid transparent;\n        border-top: 8px solid white;\n        z-index: 1001;\n      ";const A=document.createElement("div");A.style.cssText="\n        position: absolute;\n        bottom: -9px;\n        left: 20px;\n        width: 0;\n        height: 0;\n        border-left: 9px solid transparent;\n        border-right: 9px solid transparent;\n        border-top: 9px solid #d0d0d0;\n        z-index: 1000;\n      ";const S=g(v,p),M=document.createElement("div");if(M.style.cssText="\n        display: flex;\n        flex-direction: column;\n        gap: 1px;\n      ",o.showUtilizationText){const e=document.createElement("div");e.textContent=m,e.style.cssText="\n          font-size: 16px;\n          color: #000000;\n          line-height: 1.2;\n          font-weight: 900;\n        ",M.appendChild(e)}const k=document.createElement("div");k.textContent=i,k.style.cssText="\n        font-size: 13px;\n        font-weight: 700;\n        color: #000000;\n        line-height: 1.2;\n      ",M.appendChild(k),y.appendChild(S),y.appendChild(M),y.appendChild(A),y.appendChild(w),u.appendChild(y),r.push({element:y,geometry:l,data:t})}x.current=r,c(r)}))})(t)}),500)}else if(n&&0===n.length){document.querySelectorAll(".parking-lot-map-label").forEach((e=>{e.parentNode&&e.parentNode.removeChild(e)}))}}}return null})):null,a&&0!==a.length?r&&0!==r.length?null:(0,e.jsx)("div",{className:"no-data"},(0,e.jsx)(e.FormattedMessage,{id:"configureDataSource",defaultMessage:v})):(0,e.jsx)("div",{className:"no-data"},(0,e.jsx)(e.FormattedMessage,{id:"selectMap",defaultMessage:"Please select a map widget in the settings"})))};function k(e){i.p=e}})(),r})())}}}));