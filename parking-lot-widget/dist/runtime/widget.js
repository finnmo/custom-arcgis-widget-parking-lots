System.register(["jimu-core","jimu-arcgis"],(function(t,e){var n={},i={};return{setters:[function(t){n.DataSourceComponent=t.DataSourceComponent,n.FormattedMessage=t.FormattedMessage,n.React=t.React,n.jsx=t.jsx,n.loadArcGISJSAPIModules=t.loadArcGISJSAPIModules},function(t){i.JimuMapViewComponent=t.JimuMapViewComponent}],execute:function(){t((()=>{var t={56:(t,e,n)=>{"use strict";t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},72:t=>{"use strict";var e=[];function n(t){for(var n=-1,i=0;i<e.length;i++)if(e[i].identifier===t){n=i;break}return n}function i(t,i){for(var r={},l=[],a=0;a<t.length;a++){var s=t[a],u=i.base?s[0]+i.base:s[0],c=r[u]||0,d="".concat(u," ").concat(c);r[u]=c+1;var p=n(d),f={css:s[1],media:s[2],sourceMap:s[3],supports:s[4],layer:s[5]};if(-1!==p)e[p].references++,e[p].updater(f);else{var m=o(f,i);i.byIndex=a,e.splice(a,0,{identifier:d,updater:m,references:1})}l.push(d)}return l}function o(t,e){var n=e.domAPI(e);n.update(t);return function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,o){var r=i(t=t||[],o=o||{});return function(t){t=t||[];for(var l=0;l<r.length;l++){var a=n(r[l]);e[a].references--}for(var s=i(t,o),u=0;u<r.length;u++){var c=n(r[u]);0===e[c].references&&(e[c].updater(),e.splice(c,1))}r=s}}},113:t=>{"use strict";t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},244:t=>{"use strict";t.exports=n},314:t=>{"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",i=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),i&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),i&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,i,o,r){"string"==typeof t&&(t=[[null,t,void 0]]);var l={};if(i)for(var a=0;a<this.length;a++){var s=this[a][0];null!=s&&(l[s]=!0)}for(var u=0;u<t.length;u++){var c=[].concat(t[u]);i&&l[c[0]]||(void 0!==r&&(void 0===c[5]||(c[1]="@layer".concat(c[5].length>0?" ".concat(c[5]):""," {").concat(c[1],"}")),c[5]=r),n&&(c[2]?(c[1]="@media ".concat(c[2]," {").concat(c[1],"}"),c[2]=n):c[2]=n),o&&(c[4]?(c[1]="@supports (".concat(c[4],") {").concat(c[1],"}"),c[4]=o):c[4]="".concat(o)),e.push(c))}},e}},400:(t,e,n)=>{"use strict";n.d(e,{A:()=>a});var i=n(601),o=n.n(i),r=n(314),l=n.n(r)()(o());l.push([t.id,'.parking-lot-widget{padding:16px;font-family:"Avenir Next","Helvetica Neue",Arial,sans-serif}.parking-lot-widget,.parking-lot-widget *{pointer-events:none !important;user-select:none !important}.widget-header{margin-bottom:16px}.widget-header h3{margin:0;font-size:18px;font-weight:600;color:#323232}.widget-content{min-height:100px}.parking-lot-list{display:flex;flex-direction:column;gap:12px}.parking-lot-item{background:white;border-radius:8px;padding:10px 12px;box-shadow:0 2px 8px rgba(0, 0, 0, 0.1);border:1px solid #e0e0e0}.parking-lot-content{display:flex;align-items:center;gap:12px;margin-bottom:2px}.utilization-dot{width:20px;height:20px;border-radius:50%;flex-shrink:0;border:2px solid white;box-shadow:0 1px 3px rgba(0, 0, 0, 0.2)}.parking-lot-name{font-size:16px;font-weight:700;color:#323232;line-height:1.3;display:flex;align-items:center}.utilization-text{font-size:14px;color:#666;font-weight:400;margin-left:32px}.no-data{text-align:center;color:#999;font-style:italic;padding:20px;background:#f8f8f8;border-radius:8px;border:1px dashed #ccc}.loading{text-align:center;color:#666;padding:20px;background:#f8f8f8;border-radius:8px;border:1px solid #e0e0e0}@media(max-width: 480px){.parking-lot-widget{padding:12px}.parking-lot-item{padding:10px}.parking-lot-name{font-size:14px}.utilization-text{font-size:12px}}.parking-lot-item:hover{box-shadow:0 4px 12px rgba(0, 0, 0, 0.15);transform:translateY(-1px);transition:all .2s ease}.parking-lot-widget.loading{opacity:.6;pointer-events:none}.parking-lot-widget.loading::after{content:"";position:absolute;top:50%;left:50%;width:20px;height:20px;margin:-10px 0 0 -10px;border:2px solid #f3f3f3;border-top:2px solid #3498db;border-radius:50%;animation:spin 1s linear infinite}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}',""]);const a=l},540:t=>{"use strict";t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},601:t=>{"use strict";t.exports=function(t){return t[1]}},659:t=>{"use strict";var e={};t.exports=function(t,n){var i=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(n)}},686:t=>{"use strict";t.exports=i},825:t=>{"use strict";t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var i="";n.supports&&(i+="@supports (".concat(n.supports,") {")),n.media&&(i+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(i+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),i+=n.css,o&&(i+="}"),n.media&&(i+="}"),n.supports&&(i+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}}},e={};function o(n){var i=e[n];if(void 0!==i)return i.exports;var r=e[n]={id:n,exports:{}};return t[n](r,r.exports,o),r.exports}o.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return o.d(e,{a:e}),e},o.d=(t,e)=>{for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},o.p="",o.nc=void 0;var r={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(r),o.d(r,{__set_webpack_public_path__:()=>F,default:()=>E});var t=o(244),e=o(686),n=o(72),i=o.n(n),l=o(825),a=o.n(l),s=o(659),u=o.n(s),c=o(56),d=o.n(c),p=o(540),f=o.n(p),m=o(113),v=o.n(m),g=o(400),h={};h.styleTagTransform=v(),h.setAttributes=d(),h.insert=u().bind(null,"head"),h.domAPI=a(),h.insertStyleElement=f();i()(g.A,h);g.A&&g.A.locals&&g.A.locals;const x="Please configure a data source in the widget settings";var y=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function l(t){try{s(i.next(t))}catch(t){r(t)}}function a(t){try{s(i.throw(t))}catch(t){r(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(l,a)}s((i=i.apply(t,e||[])).next())}))};const b="http://www.w3.org/2000/svg",A=50,w=46,S=(t,e,n,i)=>{const o=Math.PI/180*i;return{x:t+n*Math.cos(o),y:e+n*Math.sin(o)}},C=(t,e,n,i,o)=>{const r=i+o,l=S(t,e,n,i),a=S(t,e,n,r),s=Math.abs(o)>180?"1":"0",u=o<0?"0":"1";return["M",l.x.toFixed(2),l.y.toFixed(2),"A",n.toFixed(2),n.toFixed(2),"0",s,u,a.x.toFixed(2),a.y.toFixed(2)].join(" ")},k=(t,e,n,i,o)=>{const r=S(t,e,n,i),l=S(t,e,n,i+o),a=Math.abs(o)>180?"1":"0",s=o<0?"0":"1";return["M",t.toFixed(2),e.toFixed(2),"L",r.x.toFixed(2),r.y.toFixed(2),"A",n.toFixed(2),n.toFixed(2),"0",a,s,l.x.toFixed(2),l.y.toFixed(2),"Z"].join(" ")},E=n=>{const{config:i,id:o,useDataSources:r,useMapWidgetIds:l}=n,a=(null==r?void 0:r[0])||null,s=!!(l&&l.length>0),u=!!a,c=s&&u,[d,p]=t.React.useState(null),[f,m]=t.React.useState([]),[v,g]=t.React.useState(null),[h,S]=t.React.useState(null),[E,F]=t.React.useState(!1),[M,R]=t.React.useState(!0),N=t.React.useRef(null),z=t.React.useRef(null),I=t.React.useRef([]),T=t.React.useRef(null),D=t.React.useRef(null),U=t.React.useRef(!1),j=t.React.useRef(!1),L=t.React.useRef(null),P=t.React.useRef(null),q=t.React.useRef(null),B=t.React.useRef(null),G=t.React.useRef(null),$=(null==a?void 0:a.dataSourceId)||null,J=null!==$&&P.current===$,O=u&&M&&!J,_=t.React.useMemo((()=>({returnGeometry:!0})),[]),V=t.React.useRef(!1),H=t.React.useCallback((t=>{var e;const n=null==l?void 0:l[0],i=null===(e=null==t?void 0:t.view)||void 0===e?void 0:e.container,o=null==i?void 0:i.parentElement,r=n?document.querySelector(`[data-widget-id="${n}"] .map-root`):null,a=n?document.querySelector(`[data-widget-id="${n}"] .esri-view-root`):null,s=n?document.querySelector(`[data-widget-id="${n}"] .esri-view`):null,u=n?document.querySelector(`[data-widget-id="${n}"]`):null;return i||o||a||s||r||u||null}),[l]),W=t.React.useCallback((t=>{if(!t)return;t.querySelectorAll(".parking-lot-map-label").forEach((t=>{t.parentNode&&t.parentNode.removeChild(t)}))}),[]),Y=t.React.useCallback((t=>{var e,n,i;if(!t)return null;if(null===(e=null==t?void 0:t.feature)||void 0===e?void 0:e.geometry)return t.feature;if((null===(n=null==t?void 0:t.feature)||void 0===n?void 0:n.attributes)&&"function"==typeof(null==t?void 0:t.getJSAPIGeometry)){const e=t.getJSAPIGeometry();if(e)return{geometry:e,attributes:t.feature.attributes}}if("function"==typeof(null==t?void 0:t.getJSAPIGeometry)){const e=t.getJSAPIGeometry(),n=(null===(i=t.getData)||void 0===i?void 0:i.call(t))||{};if(e)return{geometry:e,attributes:n}}return(null==t?void 0:t.attributes)&&(null==t?void 0:t.geometry)?t:null}),[]),Z=t.React.useCallback((t=>{var e;return t?"function"==typeof(null==t?void 0:t.getData)?t.getData()||null:(null===(e=null==t?void 0:t.feature)||void 0===e?void 0:e.attributes)?t.feature.attributes:(null==t?void 0:t.attributes)?t.attributes:null:null}),[]),K=t.React.useCallback((t=>{if(t){p(t);const e=H(t);e&&(e.tagName,e.className,g(e))}}),[H]);t.React.useEffect((()=>{if(v||!(null==d?void 0:d.view))return;const t=H(d);t&&(t.tagName,t.className,g(t))}),[d,v,H]),t.React.useEffect((()=>{if(!v)return;"static"===window.getComputedStyle(v).position&&(v.style.position="relative"),v.style.userSelect="none",v.style.webkitUserSelect="none",v.style.msUserSelect="none"}),[v]),t.React.useEffect((()=>{var t,e,n,i,o,r,l,a,s,u,c,d;if(!v)return;const p=v.closest(".map-base"),f=v.querySelector(".esri-view-surface"),m=v.querySelector("canvas"),g=null!==(t=null==p?void 0:p.style.pointerEvents)&&void 0!==t?t:"",h=null!==(e=null==p?void 0:p.style.position)&&void 0!==e?e:"",x=null!==(n=null==p?void 0:p.style.zIndex)&&void 0!==n?n:"",y=null!==(i=v.style.position)&&void 0!==i?i:"",b=null!==(o=v.style.zIndex)&&void 0!==o?o:"",A=null!==(r=v.style.pointerEvents)&&void 0!==r?r:"",w=null!==(l=null==f?void 0:f.style.pointerEvents)&&void 0!==l?l:"",S=null!==(a=null==f?void 0:f.style.position)&&void 0!==a?a:"",C=null!==(s=null==f?void 0:f.style.zIndex)&&void 0!==s?s:"",k=null!==(u=null==m?void 0:m.style.pointerEvents)&&void 0!==u?u:"",E=null!==(c=null==m?void 0:m.style.position)&&void 0!==c?c:"",F=null!==(d=null==m?void 0:m.style.zIndex)&&void 0!==d?d:"";return p&&(p.style.pointerEvents="auto","static"===window.getComputedStyle(p).position&&(p.style.position="relative"),p.style.zIndex="0"),"static"===window.getComputedStyle(v).position&&(v.style.position="relative"),v.style.pointerEvents="auto",v.style.zIndex="2",f&&(f.style.pointerEvents="auto",f.style.position="relative",f.style.zIndex="3"),m&&(m.style.pointerEvents="auto",m.style.position="relative",m.style.zIndex="4"),()=>{p&&(p.style.pointerEvents=g),p&&(p.style.position=h),p&&(p.style.zIndex=x),v.style.position=y,v.style.zIndex=b,v.style.pointerEvents=A,f&&(f.style.pointerEvents=w),f&&(f.style.position=S),f&&(f.style.zIndex=C),m&&(m.style.pointerEvents=k),m&&(m.style.position=E),m&&(m.style.zIndex=F)}}),[v]),t.React.useLayoutEffect((()=>{if(N.current)return()=>{}}),[o]),t.React.useEffect((()=>{var t;const e=null===(t=null==d?void 0:d.view)||void 0===t?void 0:t.container;if(!e)return;const n=document.querySelector(`[data-widgetid="${o}"]`),i=e.closest(".map-base"),r=[],l=t=>{t&&(r.push({el:t,prev:t.style.pointerEvents||""}),t.style.pointerEvents="auto")};return l(n),l(i),l(e),()=>{r.forEach((({el:t,prev:e})=>{t.style.pointerEvents=e}))}}),[o,d]),t.React.useEffect((()=>{if(d&&f.length>0){const t=()=>{const t=d.view.zoom,e=Math.max(.3,Math.min(1,(t-10)/8));f.forEach((t=>{try{const n=d.view.toScreen(t.geometry);if(t.element){t.element.style.transform=`scale(${e})`,t.element.style.transformOrigin="20px bottom";const i=t.element.offsetHeight||60;t.element.style.left=n.x-20+"px",t.element.style.top=n.y-i-8+"px"}}catch(t){}}))},e=()=>{null===T.current&&(T.current=window.requestAnimationFrame((()=>{T.current=null,t()})))},n=[d.view.watch("extent",e),d.view.watch("center",e),d.view.watch("zoom",e)];return e(),()=>{null!==T.current&&(window.cancelAnimationFrame(T.current),T.current=null),n.forEach((t=>{t&&"function"==typeof t.remove&&t.remove()}))}}}),[d,f]),t.React.useEffect((()=>()=>{f.forEach((t=>{t.element&&t.element.parentNode&&t.element.parentNode.removeChild(t.element)}))}),[f]),t.React.useEffect((()=>{if(!V.current)return void(V.current=!0);W(v),m([]),F(!0),R(!0),z.current=null,D.current=null,U.current=!1,j.current=!1,L.current=null,P.current=null,q.current=null,B.current=null}),[W,i.parkingLotField,i.utilizationField,i.showUtilizationText,i.allowNegatives,i.fullThreshold,i.availableColor,i.unavailableColor]),t.React.useEffect((()=>{if(!r||0===r.length)return S(null),F(!1),R(!1),L.current=null,P.current=null,q.current=null,void(B.current=null);const t=$;null===h&&!!t&&P.current!==t&&B.current!==t&&(B.current=t,R(!0),F(!0),L.current=null,z.current=null,q.current=null),null!==h&&t!==h&&(z.current=null,W(v),m([]),D.current=null,U.current=!1,j.current=!1,L.current=null,P.current=null,B.current=null,F(!0),R(!0),q.current=null),h!==t&&S(t)}),[$,h,W,v]);const Q=t.React.useCallback((t=>{null==t||t.reason;return F(!0),!0}),[]),X=t.React.useCallback((t=>{var e;if(!v)return;const n=v.querySelectorAll(".parking-lot-map-label");if(0===n.length)return;const o=new Map;n.forEach((t=>{const e=t.getAttribute("data-parking-lot-id");e&&o.set(e,t)}));for(const n of t){const t=Z(n);if(!t)continue;const r=null==t?void 0:t[i.parkingLotField],l=null==t?void 0:t[i.utilizationField];if(!r)continue;const a=String(r),s=o.get(a);if(!s)continue;const u=Number(l),c=Number.isFinite(u)?u:0,d=i.availableColor||"#d638c9",p=i.unavailableColor||"#8B8B8B",f=Math.max(0,Math.min(100,null!==(e=i.fullThreshold)&&void 0!==e?e:95));let m=100-c;!i.allowNegatives&&m<0&&(m=0);const v=c>=f||m<=Math.max(0,100-f)?"Full":`${Math.round(Math.max(0,Math.min(100,m)))}% Available`,g=i.showUtilizationText?v:"";let h=100-c;!i.allowNegatives&&h<0&&(h=0);const x=Math.max(0,Math.min(100,h));s.setAttribute("aria-label",`${r}: ${v}`);const y=Array.from(s.children),S=y[0],E=y[1];if(S){const t=S.querySelector("svg");if(t){const e=Math.max(0,Math.min(100,x)),n=-Math.min(e/100*360,359.999),i=Array.from(t.children),o=i[0];o&&"circle"===o.tagName&&o.setAttribute("fill",p);for(let e=i.length-2;e>=1;e--)t.removeChild(i[e]);if(e>0)if(e>=99.5){const e=document.createElementNS(b,"circle");e.setAttribute("cx",A.toFixed(2)),e.setAttribute("cy",A.toFixed(2)),e.setAttribute("r",(w-3).toFixed(2)),e.setAttribute("fill",d),e.setAttribute("stroke","none"),t.insertBefore(e,t.lastChild)}else{const e=document.createElementNS(b,"path");e.setAttribute("d",k(A,A,w-3,-90,n)),e.setAttribute("fill",d),e.setAttribute("stroke","none"),t.insertBefore(e,t.lastChild);const i=document.createElementNS(b,"path");i.setAttribute("d",C(A,A,w-3,-90,n)),i.setAttribute("fill","none"),i.setAttribute("stroke",d),i.setAttribute("stroke-width","3.5"),t.insertBefore(i,t.lastChild)}}}if(E){const t=Array.from(E.children);let e=i.showUtilizationText?0:-1,n=i.showUtilizationText?1:0;if(i.showUtilizationText&&e>=0&&t[e]){const n=t[e];n.textContent!==g&&(n.textContent=g)}if(t[n]){const e=t[n];e.textContent!==r&&(e.textContent=r)}}}}),[v,Z,i.parkingLotField,i.utilizationField,i.availableColor,i.unavailableColor,i.allowNegatives,i.showUtilizationText,i.fullThreshold]);t.React.useEffect((()=>{var t,e,n,o;if(!E)return;if(null===(t=null==d?void 0:d.view)||void 0===t||t.ready,!(null===(e=null==d?void 0:d.view)||void 0===e?void 0:e.ready))return null===(n=null==d?void 0:d.view)||void 0===n||n.ready,void F(!1);if(!h)return void F(!1);if(!v)return void F(!1);const r=z.current,l=$;if(!r||!l||h!==l)return void F(!1);const a=null===(o=r.getStatus)||void 0===o?void 0:o.call(r);if("LOADED"!==a)return void F(!1);if(U.current||j.current)return U.current,void j.current;L.current=l;let s=!1;return U.current=!0,j.current=!0,y(void 0,void 0,void 0,(function*(){var t;try{const e=()=>y(void 0,void 0,void 0,(function*(){var t,e;const n=(null===(t=null==r?void 0:r.getRecords)||void 0===t?void 0:t.call(r))||[],o=n.slice(0,1e3);if(G.current!==l){const t=o.slice(0,5).map(((t,e)=>{const n=Z(t),o=null==n?void 0:n[i.utilizationField],r=Number(o);return{index:e,parkingLot:null==n?void 0:n[i.parkingLotField],rawUtilization:o,rawType:typeof o,parsedUtilization:r,parsedIsFinite:Number.isFinite(r)}})),e=o.reduce(((t,e)=>{const n=Z(e);return Number.isFinite(Number(null==n?void 0:n[i.utilizationField]))?t+1:t}),0);console.log("[parking-lot-widget][diag] utilization field probe",{dsId:l,parkingLotField:i.parkingLotField,utilizationField:i.utilizationField,recordsCount:o.length,finiteUtilizationCount:e,nonFiniteUtilizationCount:Math.max(0,o.length-e),sample:t}),G.current=l}const a=o.map((t=>Y(t))).filter((t=>t)),s=a.filter((t=>null==t?void 0:t.geometry));if(n.length,a.length,s.length,i.parkingLotField,i.utilizationField,n.length>0){const t=n[0],o="function"==typeof(null==t?void 0:t.getData)?t.getData():(null==t?void 0:t.attributes)||(null===(e=null==t?void 0:t.feature)||void 0===e?void 0:e.attributes);null==t||t.getData,null==t||t.getJSAPIGeometry,o&&Object.keys(o),i.parkingLotField,null==o||o[i.parkingLotField],i.utilizationField,null==o||o[i.utilizationField]}return n.length,o.length,s.length,s})),n=yield e();if(n.length,n.length,s)return;if(0===n.length){const e=((null===(t=null==r?void 0:r.getRecords)||void 0===t?void 0:t.call(r))||[]).slice(0,1e3),n=e.length>0;return v.querySelectorAll(".parking-lot-map-label").length,e.length,n&&(X(e),e.length),F(!1),n?(R(!1),void(P.current=l)):void(L.current=null)}const o=v.querySelectorAll(".parking-lot-map-label").length,a=0===o;if(n.length,a){n.length,yield it(n);const t=v.querySelectorAll(".parking-lot-map-label").length;t>0&&(D.current=l)}else n.length,yield ot(n);F(!1),R(!1),P.current=l,v.querySelectorAll(".parking-lot-map-label").length}catch(t){String(t),F(!1)}finally{U.current=!1,j.current=!1}})),()=>{s=!0}}),[E,d,h,$,v,i.parkingLotField,i.utilizationField,i.showUtilizationText,i.allowNegatives,i.fullThreshold,i.availableColor,i.unavailableColor,Y,X]);const tt=t.React.useCallback(((t,e)=>{if(null==t||t.status,null==e||e.status,null==t||t.sourceVersion,null==e||e.sourceVersion,null==t||t.needRefresh,null==e||e.needRefresh,null==t||t.sourceVersion,null==t||t.status,null==e||e.status,null==e||e.sourceVersion,L.current,!t)return;const n=$;if(!n)return;if("LOAD_ERROR"===t.status)return F(!1),R(!1),void(P.current=n);"LOADED"===t.status&&L.current!==n&&P.current!==n&&Q({reason:"data-source-initial-loaded"})}),[$,Q]),et=t=>{var e;const n=Math.max(0,Math.min(100,null!==(e=i.fullThreshold)&&void 0!==e?e:95));let o=100-t;if(!i.allowNegatives&&o<0&&(o=0),t>=n||o<=Math.max(0,100-n))return"Full";const r=Math.max(0,Math.min(100,o));return`${Math.round(r)}% Available`},nt=(t,e,n)=>{const i=Math.max(0,Math.min(100,t)),o=-Math.min(i/100*360,359.999),r=document.createElement("div");r.style.cssText="\n      width: 44px;\n      height: 44px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      flex-shrink: 0;\n      pointer-events: none;\n    ",r.setAttribute("aria-hidden","true");const l=document.createElementNS(b,"svg");l.setAttribute("width","44"),l.setAttribute("height","44"),l.setAttribute("viewBox","0 0 100 100"),l.style.display="block",l.style.flexShrink="0",l.style.pointerEvents="none",l.setAttribute("role","presentation"),l.setAttribute("focusable","false");const a=document.createElementNS(b,"circle");if(a.setAttribute("cx",A.toFixed(2)),a.setAttribute("cy",A.toFixed(2)),a.setAttribute("r",w.toFixed(2)),a.setAttribute("fill",n),a.setAttribute("stroke","none"),l.appendChild(a),i>0)if(i>=99.5){const t=document.createElementNS(b,"circle");t.setAttribute("cx",A.toFixed(2)),t.setAttribute("cy",A.toFixed(2)),t.setAttribute("r",(w-3).toFixed(2)),t.setAttribute("fill",e),t.setAttribute("stroke","none"),l.appendChild(t)}else{const t=document.createElementNS(b,"path");t.setAttribute("d",k(A,A,w-3,-90,o)),t.setAttribute("fill",e),t.setAttribute("stroke","none"),l.appendChild(t);const n=document.createElementNS(b,"path");n.setAttribute("d",C(A,A,w-3,-90,o)),n.setAttribute("fill","none"),n.setAttribute("stroke",e),n.setAttribute("stroke-width","3.5"),l.appendChild(n)}const s=document.createElementNS(b,"circle");return s.setAttribute("cx",A.toFixed(2)),s.setAttribute("cy",A.toFixed(2)),s.setAttribute("r",(w-1.5).toFixed(2)),s.setAttribute("fill","none"),s.setAttribute("stroke","#333333"),s.setAttribute("stroke-width","3"),l.appendChild(s),r.appendChild(l),r},it=e=>y(void 0,void 0,void 0,(function*(){if(null==e||e.length,!v||!d)return;let n=null;try{n=(yield(0,t.loadArcGISJSAPIModules)(["esri/geometry/projection","esri/geometry/Point","esri/geometry/SpatialReference"]))[0],yield n.load()}catch(t){}const o=new Set,r=[],l=new Map;v.querySelectorAll(".parking-lot-map-label").forEach((t=>{const e=t.getAttribute("data-parking-lot-id");e&&l.set(e,t)}));const a={};for(const t of e){let e,s=null;if("function"==typeof t.getData){e=t.getData();try{if("function"==typeof t.getJSAPIGeometry)s=t.getJSAPIGeometry();else if("function"==typeof t.getGeometry){const e=t.getGeometry();e&&(s=e)}}catch(t){}}else t.attributes&&t.geometry?(e=t.attributes,s=t.geometry):(e=t.data||t.attributes||t,s=t.geometry||t.geom||null);const u=null==e?void 0:e[i.parkingLotField],c=null==e?void 0:e[i.utilizationField];if(!s){a.noGeometry=(a.noGeometry||0)+1;continue}if(!u){a.noName=(a.noName||0)+1;continue}const p=Number(c),f=Number.isFinite(p)?p:0,m=i.availableColor||"#d638c9",g=i.unavailableColor||"#8B8B8B",h=et(f),x=i.showUtilizationText?h:"";let y=100-f;!i.allowNegatives&&y<0&&(y=0);const S=Math.max(0,Math.min(100,y)),E=String(u);o.add(E);try{const t=d.view.spatialReference,e=s.spatialReference;if(n&&e&&t&&e.wkid!==t.wkid){const e=n.project(s,t);e&&(s=e)}}catch(t){}let F;try{F=d.view.toScreen(s)}catch(t){a.coordError=(a.coordError||0)+1;continue}let M=l.get(E);const R=!M;if(M){const t=F.x-50+"px",n=F.y-30+"px";M.style.left!==t&&(M.style.left=t),M.style.top!==n&&(M.style.top=n),M.setAttribute("aria-label",`${u}: ${h}`);const o=Array.from(M.children),l=o[0],a=o[1];if(l){const t=l.querySelector("svg");if(t){const e=Math.max(0,Math.min(100,S)),n=-Math.min(e/100*360,359.999),i=Array.from(t.children),o=i[0];o&&"circle"===o.tagName&&o.setAttribute("fill",g);for(let e=i.length-2;e>=1;e--)t.removeChild(i[e]);if(e>0)if(e>=99.5){const e=document.createElementNS(b,"circle");e.setAttribute("cx",A.toFixed(2)),e.setAttribute("cy",A.toFixed(2)),e.setAttribute("r",(w-3).toFixed(2)),e.setAttribute("fill",m),e.setAttribute("stroke","none"),t.insertBefore(e,t.lastChild)}else{const e=document.createElementNS(b,"path");e.setAttribute("d",k(A,A,w-3,-90,n)),e.setAttribute("fill",m),e.setAttribute("stroke","none"),t.insertBefore(e,t.lastChild);const i=document.createElementNS(b,"path");i.setAttribute("d",C(A,A,w-3,-90,n)),i.setAttribute("fill","none"),i.setAttribute("stroke",m),i.setAttribute("stroke-width","3.5"),t.insertBefore(i,t.lastChild)}}}if(a){const t=Array.from(a.children);let e=i.showUtilizationText?0:-1,n=i.showUtilizationText?1:0;if(i.showUtilizationText&&e>=0&&t[e]){const n=t[e];n.textContent!==x&&(n.textContent=x)}if(t[n]){const e=t[n];e.textContent!==u&&(e.textContent=u)}}r.push({element:M,geometry:s,data:e});continue}M=document.createElement("div"),M.className="parking-lot-map-label",M.setAttribute("role","img"),M.setAttribute("aria-label",`${u}: ${h}`),M.setAttribute("tabindex","-1"),M.setAttribute("data-parking-lot-id",E),M.style.cssText=`\n        position: absolute;\n        left: ${F.x-50}px;\n        top: ${F.y-30}px;\n        background: white;\n        border-radius: 12px;\n        padding: 8px 8px;\n        box-shadow: 0 2px 8px rgba(0,0,0,0.15);\n        border: 1px solid #d0d0d0;\n        font-family: 'Avenir Next', 'Helvetica Neue', Arial, sans-serif;\n        z-index: 1000;\n        pointer-events: none;\n        user-select: none;\n        display: flex;\n        align-items: center;\n        gap: 8px;\n        min-width: 150px;\n      `;const N=document.createElement("div");N.style.cssText="\n        position: absolute;\n        bottom: -8px;\n        left: 20px;\n        width: 0;\n        height: 0;\n        border-left: 8px solid transparent;\n        border-right: 8px solid transparent;\n        border-top: 8px solid white;\n        z-index: 1001;\n      ";const z=document.createElement("div");z.style.cssText="\n        position: absolute;\n        bottom: -9px;\n        left: 20px;\n        width: 0;\n        height: 0;\n        border-left: 9px solid transparent;\n        border-right: 9px solid transparent;\n        border-top: 9px solid #d0d0d0;\n        z-index: 1000;\n      ";const I=nt(S,m,g),T=document.createElement("div");if(T.style.cssText="\n        display: flex;\n        flex-direction: column;\n        gap: 1px;\n      ",i.showUtilizationText){const t=document.createElement("div");t.textContent=x,t.style.cssText="\n          font-size: 16px;\n          color: #000000;\n          line-height: 1.2;\n          font-weight: 900;\n        ",T.appendChild(t)}const D=document.createElement("div");D.textContent=u,D.style.cssText="\n        font-size: 13px;\n        font-weight: 700;\n        color: #000000;\n        line-height: 1.2;\n      ",T.appendChild(D),M.appendChild(I),M.appendChild(T),M.appendChild(z),M.appendChild(N);M.childNodes.length;if(R)try{v.appendChild(M)}catch(t){continue}else M.childNodes.length,T.textContent;r.push({element:M,geometry:s,data:e})}l.forEach(((t,e)=>{o.has(e)||t.parentNode&&t.parentNode.removeChild(t)}));v.querySelectorAll(".parking-lot-map-label").length;r.length,r.filter((t=>!l.has(t.element.getAttribute("data-parking-lot-id")||""))).length,r.filter((t=>l.has(t.element.getAttribute("data-parking-lot-id")||""))).length,v&&v.tagName,e.length,I.current=r,m(r)})),ot=t=>y(void 0,void 0,void 0,(function*(){if(null==t||t.length,!v||!d)return;const e=v.querySelectorAll(".parking-lot-map-label"),n=new Map,o=new Set;e.forEach((t=>{const e=t.getAttribute("data-parking-lot-id");e&&n.set(e,t)})),n.size,t.length;for(const e of t){let t,r=null;if("function"==typeof e.getData){t=e.getData();try{if("function"==typeof e.getJSAPIGeometry)r=e.getJSAPIGeometry();else if("function"==typeof e.getGeometry){const t=e.getGeometry();t&&(r=t)}}catch(t){continue}}else e.attributes&&e.geometry?(t=e.attributes,r=e.geometry):(t=e.data||e.attributes||e,r=e.geometry||e.geom||null);const l=null==t?void 0:t[i.parkingLotField],a=null==t?void 0:t[i.utilizationField];if(!r||!l)continue;const s=String(l);o.add(s);const u=n.get(s);if(!u)continue;const c=Number(a),p=Number.isFinite(c)?c:0,f=i.availableColor||"#d638c9",m=i.unavailableColor||"#8B8B8B",v=et(p),g=i.showUtilizationText?v:"";let h=100-p;!i.allowNegatives&&h<0&&(h=0);const x=Math.max(0,Math.min(100,h));try{const t=d.view.toScreen(r),e=t.x-50+"px",n=t.y-30+"px";u.style.left!==e&&(u.style.left=e),u.style.top!==n&&(u.style.top=n)}catch(t){}u.setAttribute("aria-label",`${l}: ${v}`);const y=Array.from(u.children),S=y[0],E=y[1];if(S){const t=S.querySelector("svg");if(t){const e=Math.max(0,Math.min(100,x)),n=Math.min(e/100*360,359.999),i=Array.from(t.children),o=i[0];o&&"circle"===o.tagName&&o.setAttribute("fill",m);for(let e=i.length-2;e>=1;e--)t.removeChild(i[e]);if(e>0)if(e>=99.5){const e=document.createElementNS(b,"circle");e.setAttribute("cx",A.toFixed(2)),e.setAttribute("cy",A.toFixed(2)),e.setAttribute("r",(w-3).toFixed(2)),e.setAttribute("fill",f),e.setAttribute("stroke","none"),t.insertBefore(e,t.lastChild)}else{const e=document.createElementNS(b,"path");e.setAttribute("d",k(A,A,w-3,-90,n)),e.setAttribute("fill",f),e.setAttribute("stroke","none"),t.insertBefore(e,t.lastChild);const i=document.createElementNS(b,"path");i.setAttribute("d",C(A,A,w-3,-90,n)),i.setAttribute("fill","none"),i.setAttribute("stroke",f),i.setAttribute("stroke-width","3.5"),t.insertBefore(i,t.lastChild)}}}if(E){const t=Array.from(E.children);let e=i.showUtilizationText?0:-1,n=i.showUtilizationText?1:0;if(i.showUtilizationText&&e>=0&&t[e]){const n=t[e];n.textContent!==g&&(n.textContent=g)}if(t[n]){const e=t[n];e.textContent!==l&&(e.textContent=l)}}}n.forEach(((t,e)=>{o.has(e)||t.parentNode&&t.parentNode.removeChild(t)})),o.size,n.size,o.size})),rt=(0,t.jsx)(t.React.Fragment,null,s&&(0,t.jsx)(e.JimuMapViewComponent,{useMapWidgetId:l[0],onActiveViewChange:K}),O?(0,t.jsx)(t.DataSourceComponent,{useDataSource:a,widgetId:o,query:_,onDataSourceInfoChange:tt},(t=>{var e,n,i,o,l,a,s;const u=null===(e=null==t?void 0:t.getMainDataSource)||void 0===e?void 0:e.call(t),c=null===(n=null==t?void 0:t.getStatus)||void 0===n?void 0:n.call(t),d=null===(i=null==u?void 0:u.getStatus)||void 0===i?void 0:i.call(u),p="UNLOADED"===c&&u&&d&&"UNLOADED"!==d?u:t;p&&(null==p?void 0:p.getRecords)&&(p.getRecords()||[]).length;return String((null===(o=null==p?void 0:p.getError)||void 0===o?void 0:o.call(p))||(null===(l=null==t?void 0:t.getError)||void 0===l?void 0:l.call(t))||""),null===(a=null==r?void 0:r[0])||void 0===a||a.dataSourceId,t?(z.current=p,null==p||p.id,null==p||p.type,null===(s=null==p?void 0:p.getStatus)||void 0===s||s.call(p),null):null})):null);return c?rt:(0,t.jsx)("div",{ref:N,className:"parking-lot-widget jimu-widget","data-widget-id":o,style:{width:"100%",height:"100%",overflow:"hidden",position:"relative",pointerEvents:"none",userSelect:"none"}},rt,s?u?null:(0,t.jsx)("div",{className:"no-data"},(0,t.jsx)(t.FormattedMessage,{id:"configureDataSource",defaultMessage:x})):(0,t.jsx)("div",{className:"no-data"},(0,t.jsx)(t.FormattedMessage,{id:"selectMap",defaultMessage:"Please select a map widget in the settings"})))};function F(t){o.p=t}})(),r})())}}}));